var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(b,g,t){function eb(d){var l=this,ta,q;MCK_GROUP_MAP=[];var J=[],T,Fa,fb=!0,ya=[],ga=0;MCK_CLIENT_GROUP_MAP=[];var za=!1,ha=[],Aa=[],Ba=90,da=[],K=[],S=[],O=[],gb=!0,H=0,hb=d.mode;MCK_LABELS=d.labels;MCK_BASE_URL=d.baseUrl;var W=d.appId,ib=[],jb=[0,1,2,3],kb=[1,2,5,6],oa=[],Ua=!1,Ra=d.launcher,pa=d.visitor,Gb=d.userName,lb=d.locShare,Ja=d.video,I=d.fileBaseUrl,L=d.onInit,mb=d.onTopicDetails,eb=[0,1,2],nb=d.onClose,ob=d.displayText,ia=d.accessToken,Oa=d.readConversation,ja=d.maxGroupSize,
pb=d.onTabClicked,Hb=d.contactNumber,qb=d.maxAttachmentSize,rb=d.appModuleName,Ca=d.getTopicDetail,Va=d.contactDisplayName,sb=d.validateMessage,Da=d.finalPriceResponse,Wa=d.contactDisplayImage,tb=d.priceWidget,X=d.openGroupSettings,Y=d.offlineMessageDetail,Ka=d.authenticationTypeId,ub=d.getConversationDetail,Yb=d.notificationIconLink,Ib=d.mapStaticAPIkey,Zb=d.notificationSoundLink?d.notificationSoundLink:"",y=pa?"guest":b.trim(d.userId),$b="undefined"===typeof d.source?1:d.source,Ga="boolean"===typeof d.topicBox?
d.topicBox:!1,ab="boolean"===typeof d.olStatus?d.olStatus:!1,Jb="boolean"===typeof d.messageBubbleAvator?d.messageBubbleAvator:!1,Xa="boolean"===typeof d.showOfflineMessage?d.showOfflineMessage:!1,Kb="boolean"===typeof d.hideGroupSubtitle?d.hideGroupSubtitle:!1,Lb="undefined"===typeof d.defaultMessageMetaData?{}:d.defaultMessageMetaData,vb="boolean"===typeof d.groupUserCount?d.groupUserCount:!1,Mb="boolean"===typeof d.checkUserBusyWithStatus?d.checkUserBusyWithStatus:!1,Nb="boolean"===typeof d.resetUserStatus?
d.resetUserStatus:!1,qa="boolean"===typeof d.topicHeader?d.topicHeader:!1,Ob=d.supportId?'data-mck-id\x3d"'+d.supportId+'"':"",wb="boolean"===typeof d.loadOwnContacts?d.loadOwnContacts:!1,Pb="boolean"===typeof d.desktopNotification?d.desktopNotification:!1,Qb="boolean"===typeof d.notification?d.notification:!0,Rb="boolean"===typeof d.swNotification?d.swNotification:!1,Sb="boolean"===typeof d.autoTypeSearchEnabled?d.autoTypeSearchEnabled:!0,bb="boolean"===typeof d.launchOnNewMessage?d.launchOnNewMessage:
!1,xb="boolean"===typeof d.launchOnUnreadMessage?d.launchOnUnreadMessage:!1,Tb="number"===typeof d.userTypeId?d.userTypeId:!1,M=["DEFAULT","NEW","OPEN"],Ub=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],B=new function(){var a=this,e=[],d=[],C=[],c=[];a.updateLatestMessage=function(b){var e=[];e.push(b);a.updateLatestMessageArray(e);a.updateMckMessageArray(e)};a.getLatestMessageArray=function(){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckLatestMessageArray")):
e};a.setLatestMessageArray=function(a){"undefined"!==typeof g.sessionStorage?g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(a)):e=a};a.updateLatestMessageArray=function(a){if("undefined"!==typeof g.sessionStorage){var c=b.parseJSON(g.sessionStorage.getItem("mckLatestMessageArray"));null!==c?(c=c.concat(a),g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(c))):g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(a));return a}return e=e.concat(a)};a.getMckMessageArray=
function(){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckMessageArray")):d};a.clearMckMessageArray=function(){"undefined"!==typeof g.sessionStorage?(g.sessionStorage.removeItem("mckMessageArray"),g.sessionStorage.removeItem("mckLatestMessageArray")):(d.length=0,e.length=0)};a.clearAppHeaders=function(){"undefined"!==typeof g.sessionStorage&&g.sessionStorage.removeItem("mckAppHeaders")};a.setAppHeaders=function(a){"undefined"!==typeof g.sessionStorage&&g.sessionStorage.setItem("mckAppHeaders",
g.JSON.stringify(a))};a.getAppHeaders=function(a){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckAppHeaders")):{}};a.getMessageByKey=function(a){return C[a]};a.updateMckMessageArray=function(a){for(var e=0;e<a.length;e++){var c=a[e];C[c.key]=c}return"undefined"!==typeof g.sessionStorage?(e=b.parseJSON(g.sessionStorage.getItem("mckMessageArray")),null!==e?(e=e.concat(a),g.sessionStorage.setItem("mckMessageArray",g.JSON.stringify(e))):g.sessionStorage.setItem("mckMessageArray",
g.JSON.stringify(a)),a):d=d.concat(a)};a.getMckContactNameArray=function(){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckContactNameArray")):c};a.setMckContactNameArray=function(a){"undefined"!==typeof g.sessionStorage?g.sessionStorage.setItem("mckContactNameArray",g.JSON.stringify(a)):c=a};a.updateMckContactNameArray=function(a){if("undefined"!==typeof g.sessionStorage){var e=b.parseJSON(g.sessionStorage.getItem("mckContactNameArray"));null!==e&&(a=a.concat(e));
g.sessionStorage.setItem("mckContactNameArray",g.JSON.stringify(a));return a}return c=c.concat(a)};a.clearMckContactNameArray=function(){"undefined"!==typeof g.sessionStorage?g.sessionStorage.removeItem("mckContactNameArray"):c.length=0}},ua={},Ya=[],La=[],Ha={},va=[],wa=[],Ma=[],Z=[],Sa=new function(){var a=this,h=!1,d,C,c=b("#mck-file-menu"),l=b("#mck-message-cell .mck-message-inner");b("#mck-tab-individual");var p=Ba;a.getLauncherHtml=function(){return'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" class\x3d"applozic-launcher mck-button-launcher" '+
("support"===hb?Ob:"")+'\x3e\x3cspan class\x3d"mck-icon-chat"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
a.initializeApp=function(e,c){h=c;var s={applicationId:e.appId,userId:y};null!==Gb&&(s.displayName=e.userName);null!==e.email&&(s.email=e.email);null!==Hb&&(s.contactNumber=e.contactNumber);e.imageLink&&(s.imageLink=e.imageLink);e.appModuleName&&(s.appModuleName=e.appModuleName);ia&&(s.password=e.accessToken);-1===eb.indexOf(Ka)&&(Ka=0);Nb&&(s.resetUserStatus=!0);"number"==typeof Tb&&(s.userTypeId=Tb);s.enableEncryption=!0;s.appVersionCode=108;s.authenticationTypeId=Ka;T=q="";a.validateAppSession(s)?
Ja&&ea.InitilizeVideoClient(y,T):b.ajax({url:MCK_BASE_URL+"/v2/tab/initialize.page",type:"post",data:g.JSON.stringify(s),contentType:"application/json",headers:{"Application-Key":W},success:function(b){Ja&&ea.InitilizeVideoClient(b.userId,b.deviceKey);B.clearMckMessageArray();B.clearMckContactNameArray();"INVALID_PASSWORD"===b?"function"===typeof L&&L({status:"error",errorMessage:"INVALID PASSWORD"}):"INVALID_APPID"===b?"function"===typeof L&&L({status:"error",errorMessage:"INVALID APPLICATION ID"}):
"error"===b||"USER_NOT_FOUND"===b?"function"===typeof L&&L({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===b?"function"===typeof L&&L({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof b&&null!==b&&b.token?(b.appId=s.applicationId,ia&&(b.accessToken=s.password),a.onInitApp(b)):"function"===typeof L&&L({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},error:function(){B.clearMckMessageArray();"function"===typeof L&&L({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};
a.onInitApp=function(c){a.appendLauncher();a.setLabels();b(".applozic-launcher").each(function(){b(this).hasClass("mck-msg-preview")||b(this).show()});ta=c.token;mckUtils.setEncryptionKey(c.encryptionKey);y=c.userId;T=c.deviceKey;Fa=c.websocketUrl;Ba=c.websocketIdleTimeLimit;I=c.fileBaseUrl;Ua=c.deactivated;q=btoa(c.userId+":"+c.deviceKey);H=c.totalUnreadCount;pa||"guest"===y||"0"===y||"C0"===y||(h?U.reconnect():U.init());e.createContactWithDetail({userId:y,displayName:c.displayName,photoLink:c.imageLink});
b.ajaxPrefilter(function(b){b.beforeSend||-1===b.url.indexOf(MCK_BASE_URL)||(b.beforeSend=function(b){a.setHeaders(b)})});if(c.betaPackage){var d="https://www.applozic.com/?utm_source\x3d"+g.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";b(".mck-running-on a").attr("href",d);b(".mck-running-on").removeClass("n-vis").addClass("vis")}d=B.getMckContactNameArray();if(null!==d&&0<d.length)for(var s=0;s<d.length;s++){var l=d[s];null!==l&&(va[l[0]]=l[1])}Q.checkUserConnectedStatus();
"function"===typeof L&&L("success",c);Sa.tabFocused();0<Ea.length&&0<H&&Ea.html(H);xb&&w.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});Za.subscribeToServiceWorker();B.setAppHeaders(c);mckGroupService.loadGroups({apzCallback:u.loadGroups})};a.validateAppSession=function(b){var e=B.getAppHeaders();if(e&&e.userId){if(b.applicationId===e.appId&&b.userId===e.userId&&b.password===e.accessToken)return a.onInitApp(e),!0;B.clearAppHeaders()}return!1};a.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",
!0);q&&a.setRequestHeader("Authorization","Basic "+q);a.setRequestHeader("Application-Key",W);T&&a.setRequestHeader("Device-Key",T);ia&&a.setRequestHeader("Access-Token",ia);rb&&a.setRequestHeader("App-Module-Name",rb)};a.setLabels=function(){b("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);b("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]);b("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",
MCK_LABELS["search.contacts"]);b("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);b("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);b("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);b("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);b("#mck-no-messages").html(MCK_LABELS["empty.messages"]);b("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);
b("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);b("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);b("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);b("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]);b("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);b("#mck-msg-error").html(MCK_LABELS["group.deleted"]);b("#mck-gc-title-label").html(MCK_LABELS["group.title"]);
b("#mck-gc-type-label").html(MCK_LABELS["group.type"]);b("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);b("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);b("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]);b("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]);
b("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);b("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);b("#mck-typing-label").html(MCK_LABELS.typing);b("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]);b("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);b("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",
MCK_LABELS["location.share.title"]);b("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);b("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);b("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);b(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);b("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);b("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close);b("#mck-loc-submit").html(MCK_LABELS.send).attr("title",
MCK_LABELS.send);b("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);b("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);b("#mck-group-name-save").attr("title",MCK_LABELS.save);b("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);b("#mck-group-name-edit").attr("title",MCK_LABELS.edit)};b(t).on("click",".fancybox",function(a){a=b(this);if(-1!==a.data("type").indexOf("video")){var e=a.find(".mck-video-box").html(),c;a.fancybox({content:e,title:a.data("name"),padding:0,openEffect:"none",
closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){c=b(".fancybox-inner").find("video").get(0);c.load();c.play()}})}else a=a.data("url"),b(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:a,type:"image"})});b(g).on("resize",function(){"block"===c.css("display")&&yb.fileMenuReposition();if(0===l.find(".mck-contact-list").length){var a=l.get(0).scrollHeight;l.height()<a&&l.animate({scrollTop:l.prop("scrollHeight")},0)}});a.appendLauncher=
function(){b("#mck-sidebox-launcher").remove();b("body").append(a.getLauncherHtml());Za.init()};a.tabFocused=function(){function b(c){var h={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};c=c||g.event;(gb=c.type in h?h[c.type]:this[e]?!1:!0)?(1>p&&fb&&U.checkConnected(!0),a.stopIdleTimeCounter()):(1===ga&&U.sendTypingStatus(0),a.manageIdleTime())}var e="hidden";e in t?t.addEventListener("visibilitychange",b):("mozHidden"===e)in t?t.addEventListener("mozvisibilitychange",b):("webkitHidden"===
e)in t?t.addEventListener("webkitvisibilitychange",b):("msHidden"===e)in t?t.addEventListener("msvisibilitychange",b):"onfocusin"in t?t.onfocusin=t.onfocusout=b:g.onpageshow=g.onpagehide=g.onfocus=g.onblur=b;void 0!==t[e]&&b({type:t[e]?"blur":"focus"})};a.manageIdleTime=function(){p=Ba;d&&clearInterval(d);d=setInterval(function(){0>--p&&(p=0,U.stopConnectedCheck(),clearInterval(d),d="")},6E4)};a.stopIdleTimeCounter=function(){p=Ba;d&&clearInterval(d);d=""};a.manageOfflineMessageTime=function(a){if("object"!==
typeof Y||isNaN(Y.timeout))g.console.log("Offline message timeout required.");else{if(1===Y.type){if(!Y.userIds||0===Y.userIds.length){g.console.log("Offline message userIds required.");return}if(-1===Y.userIds.indexOf(a))return}C&&clearInterval(C);C=setTimeout(function(){clearInterval(C);C="";e.showOfflineMessage()},5E3*parseInt(Y.timeout))}};a.stopOfflineMessageCounter=function(){C&&clearInterval(C);C=""}},yb=new function(){var a=this,e="",d="",l=!1,c=b("#mck-my-loc"),E=b("#mck-loc-box"),p=b("#mck-loc-lat"),
D=b("#mck-loc-lon"),ac=b("#mck-btn-loc"),s=b("#mck-sidebox-ft"),x=b("#mck-file-menu"),u=b("#mck-btn-attach"),t=b("#mck-map-content"),q=b("#mck-loc-address");a.init=function(){lb&&g.google&&"object"===typeof g.google.maps&&(e=new g.google.maps.Geocoder,u.on("click",function(){a.fileMenuToggle()}),ac.on("click",function(){l?E.mckModal():(mckMapUtils.getCurrentLocation(a.onGetCurrLocation,a.onErrorCurrLocation),l=!0)}));c.on("click",function(){mckMapUtils.getCurrentLocation(a.onGetMyCurrLocation,a.onErrorMyCurrLocation)})};
a.fileMenuReposition=function(){var a=s.offset();a.bottom=g.innerHeight-a.top;x.css({bottom:51<a.bottom?a.bottom:51,right:0})};a.fileMenuToggle=function(){u.hasClass("on")?(u.removeClass("on"),x.hide()):(a.fileMenuReposition(),u.addClass("on"),x.show())};a.onGetCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;a.openMapBox()};a.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;a.openMapBox()};a.onErrorMyCurrLocation=
function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};a.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;p.val(MCK_CURR_LATITIUDE);D.val(MCK_CURR_LONGITUDE);p.trigger("change");D.trigger("change");d?q.val(d):e&&e.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,b){"OK"===b&&a[1]&&(d=a[1].formatted_address)})};a.openMapBox=function(){t.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,
longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:p,longitudeInput:D,locationNameInput:q},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=a.longitude}});E.on("shown.bs.mck-box",function(){t.locationpicker("autosize")});E.mckModal()}},Q=new function(){var a=this,e=b("#mck-msg-form"),d=b("#mck-msg-error"),l=b("#mck-tab-title"),c=b("#mck-tab-status"),E=b(".mck-typing-box"),p=b("#mck-block-button"),D=
b("#mck-message-cell .mck-message-inner");a.updateUserStatus=function(a){if("object"===typeof da[a.userId]){var b=da[a.userId];0===a.status?(b.connected=!1,b.lastSeenAtTime=a.lastSeenAtTime):1===a.status&&(b.connected=!0)}else b=[],b.push(a.userId),ba.getUsersDetail(b,{})};a.getUserDetail=function(a){if("object"===typeof da[a])return da[a]};a.checkUserConnectedStatus=function(){var e=[],c=[];b(".mck-user-ol-status").each(function(){var a=b(this).data("mck-id");"undefined"!==typeof a&&""!==a&&(e.push(a),
a=mckContactUtils.formatContactId(""+a),b(this).addClass(a),b(this).next().addClass(a))});0<e.length&&(b.each(e,function(a,b){"undefined"===typeof da[b]&&c.push(b)}),0<c.length?ba.getUsersDetail(c,{setStatus:!0}):a.updateUserConnectedStatus())};a.updateUserConnectedStatus=function(){b(".mck-user-ol-status").each(function(){var a=b(this),e=a.data("mck-id");if(e){var c=da[e];"undefined"!==typeof da[e]&&c.connected?(a.removeClass("n-vis").addClass("vis"),a.next().html("("+MCK_LABELS.online+")")):(a.removeClass("vis").addClass("n-vis"),
a.next().html("(Offline)"))}})};a.lastSeenOfGroupOfTwo=function(a){g.MCK_OL_MAP[a]?(c.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),c.removeClass("n-vis").addClass("vis")):S[a]&&(a=mckDateUtils.getLastSeenAtStatus(S[a]),c.html(a),c.attr("title",a),l.addClass("mck-tab-title-w-status"),c.removeClass("n-vis").addClass("vis"))};a.toggleBlockUser=function(a,b){if(b)d.html(MCK_LABELS.blocked),d.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),e.removeClass("vis").addClass("n-vis"),l.removeClass("mck-tab-title-w-status"),
c.removeClass("vis").addClass("n-vis"),E.removeClass("vis").addClass("n-vis"),D.data("blocked",!0),p.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"]);else if(d.html(""),d.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),D.data("blocked",!1),p.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),!Aa[a]&&(g.MCK_OL_MAP[a]||S[a])){if(g.MCK_OL_MAP[a])c.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(S[a]){var x=
mckDateUtils.getLastSeenAtStatus(S[a]);c.html(x);c.attr("title",x)}l.addClass("mck-tab-title-w-status");c.removeClass("n-vis").addClass("vis")}}};new function(){var a=b("#mck-msg-to");b("#mck-btn-loc");var e=b("#mck-loc-box"),d=b("#mck-msg-sbmt"),l=b("#mck-msg-error"),c=b("#mck-loc-submit"),E=b("#mck-msg-response"),p=b("#mck_response_text"),D=b("#mck-message-cell .mck-message-inner");c.on("click",function(){var b={type:5,contentType:2,message:g.JSON.stringify(mckMapUtils.getSelectedLocation())},c=
D.data("mck-conversationid"),x=D.data("mck-topicid");c?b.conversationId=c:x&&(c={topicId:x},x=K[x],"object"===typeof x&&(c.topicDetail=g.JSON.stringify(x)),b.conversationPxy=c);!0===D.data("isgroup")?b.groupId=a.val():b.to=a.val();d.attr("disabled",!0);l.removeClass("vis").addClass("n-vis");l.html("");p.html("");E.removeClass("vis").addClass("n-vis");w.sendMessage(b);e.mckModal("hide")})};var u=new function(){var a=this,d={0:"User",1:"Admin",2:"Moderator",3:"Member"},l=b("#mck-msg-form"),C=b("#mck-msg-error"),
c=b("#mck-tab-title"),E=b("#mck-tab-status"),p=b("#mck-no-gsm-text"),D=b("#mck-gms-loading"),q=b("#mck-contact-loading");b("#mck-tab-menu-box");b("#mck-search-loading");var s=b("#mck-group-info-tab"),x=b("#mck-sidebox-search");b("#mck-group-name-box");var V=b("#mck-group-back-link"),xa=b("#mck-group-name-edit"),B=b("#mck-group-name-save"),N=b("#mck-sidebox-content"),J=b("#mck-tab-option-panel"),F=b("#mck-btn-group-create"),k=b("#mck-group-create-tab"),aa=b("#mck-contacts-content"),z=b("#mck-btn-group-update"),
ra=b("#mck-group-create-type"),Ia=b("#mck-group-icon-upload"),Ab=b("#mck-group-icon-change"),Bb=b("#mck-group-member-list"),I=b("#mck-group-update-panel"),H=b(".mck-tab-message-option"),L=b("#mck-group-create-title"),Q=b(".mck-group-menu-options"),M=b("#mck-group-member-search"),ka=b("#mck-btn-group-icon-save");b("#mck-group-info-icon-box");var $a=b(".mck-group-admin-options"),cb=b("#mck-group-add-member-box"),P=b("#mck-message-cell .mck-message-inner"),la=b("#mck-group-name-sec .mck-group-title");
b("#mck-group-create-icon-box");var da=b("#mck-group-info-icon-loading"),W=b("#mck-gm-search-box");b("#mck-group-member-search-list");var ta=b("#mck-group-create-icon-loading"),sa=b("#mck-group-info-icon-box .mck-group-icon"),Y=b("#mck-group-create-icon-box .mck-group-icon"),ma=b("#mck-group-create-icon-box .mck-overlay-box"),qa=b("#mck-gc-overlay-label");b.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
b.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b(".mck-group-name-box div[contenteditable]").keypress(function(e){if(8===e.which||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode||e.ctrlKey&&97===e.which)return!0;if(13!==e.keyCode||e.shiftKey||e.ctrlKey)return 30>this.innerHTML.length;b(e.target).hasClass("mck-group-create-title")&&a.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),mckUtils.setEndOfContenteditable(b));return!1},
"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});b(t).on("click",".mck-btn-change-role",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var e=b(this).parents(".mck-li-group-member").data("role");a.find("select").val(e);a.removeClass("n-vis").addClass("vis");I.removeClass("n-vis").addClass("vis")});z.on("click",function(){var a=[];b(".mck-group-change-role-box.vis").each(function(e,c){var d=b(this),k=parseInt(d.find("select").val()),
bc=d.parents(".mck-li-group-member").data("role");k!==bc&&(d={userId:d.parents(".mck-li-group-member").data("mck-id"),role:k},a.push(d))});if(0<a.length){var e=P.data("mck-id"),c=P.data("isgroup");e&&c&&(z.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:e,users:a,apzCallback:u.onUpdateGroupInfo}))}});b("#mck-group-info-icon-box .mck-overlay").on("click",function(a){Ab.trigger("click")});b("#mck-group-create-icon-box .mck-overlay").on("click",function(a){Ia.trigger("click")});
b(t).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var a=b(this);0===a.find(".mck-group-icon-default").length&&a.find(".mck-overlay-box").addClass("n-vis")});b(t).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").addClass("n-vis")});
xa.on("click",function(){la.attr("contenteditable",!0).focus();mckUtils.setEndOfContenteditable(la[0]);B.removeClass("n-vis").addClass("vis");xa.removeClass("vis").addClass("n-vis")});B.on("click",function(){var a=b.trim(la.text());if(0<a.length){var e=P.data("mck-id"),c=P.data("isgroup");e&&c&&(xa.removeClass("n-vis").addClass("vis"),B.removeClass("vis").addClass("n-vis"),la.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:e,name:a,apzCallback:u.onUpdateGroupInfo}))}else la.addClass("mck-req-border")});
ka.on("click",function(){var a=sa.data("iconurl");if(a){var b=P.data("mck-id"),e=P.data("isgroup");b&&e&&(setTimeout(function(){ka.removeClass("vis").addClass("n-vis")},1E3),sa.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:u.onUpdateGroupInfo}))}else la.addClass("mck-req-border")});F.on("click",function(){a.submitCreateGroup()});a.submitCreateGroup=function(){var a=b.trim(L.text()),e=ra.val(),c=Y.data("iconurl");0<a.length?(a={groupName:a},e&&(e=parseInt(e),
-1!==kb.indexOf(e)&&(a.type=e)),c&&(a.groupIcon=c),Y.data("iconurl",""),a.isInternal=!0,F.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),w.getGroup(a)):L.addClass("mck-req-border")};a.loadGroups=function(a){a=a.data;Ya.length=0;b.each(a,function(a,b){"undefined"!==typeof b.id&&(b=mckGroupUtils.addGroup(b),Ya.push(b))})};a.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};a.getGroupDisplayName=function(a){if("object"===typeof MCK_GROUP_MAP[a]){a=
MCK_GROUP_MAP[a];var b=a.displayName;if(7===a.type){var c=e.getContactFromGroupOfTwo(a);"undefined"!==typeof c&&(b=e.getTabDisplayName(c.contactId,!1))}3===a.type&&-1!==b.indexOf(y)&&(b=b.replace(y,"").replace(":",""),"function"===typeof Va&&(b=(c=Va(b))?c:b));b||5!==a.type||(b="Broadcast");b||(b=a.contactId);return b}return a};a.getGroupImage=function(a){return a?'\x3cimg src\x3d"'+a+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};a.getGroupDefaultIcon=
function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};a.addMemberToGroup=function(a,b){"object"===typeof a.members&&(-1===a.members.indexOf(b)&&a.members.push(b),"object"===typeof a.removedMembersId&&-1!==a.removedMembersId.indexOf(b)&&a.removedMembersId.splice(a.removedMembersId.indexOf(b),1),MCK_GROUP_MAP[a.contactId]=a);return a};a.removeMemberFromGroup=function(a,b){"object"!==typeof a.removedMembersId||1>a.removedMembersId.length?(a.removedMembersId=[],a.removedMembersId.push(b)):
-1===a.removedMembersId.indexOf(b)&&a.removedMembersId.push(b);return MCK_GROUP_MAP[a.contactId]=a};a.authenticateGroupUser=function(b){if(!a.isGroupLeft(b)&&0<b.members.length)for(var e=0;e<b.members.length;e++)if(y===""+b.members[e])return!0;return!1};a.isAppendOpenGroupContextMenu=function(b){return 0!==X.deleteChatAccess&&a.authenticateGroupUser(b)?b.adminName===y||2===X.deleteChatAccess?!0:!1:!1};a.validateOpenGroupUser=function(b){if(6===b.type){if(!a.authenticateGroupUser(b)){if(X.disableChatForNonGroupMember){var e=
X.defaultChatDisabledMessage;e||(e="Chat disabled");C.html(e);C.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");c.removeClass("mck-tab-title-w-status");E.removeClass("vis").addClass("n-vis")}Q.removeClass("vis").addClass("n-vis");H.removeClass("vis").addClass("n-vis");J.removeClass("vis").addClass("n-vis");"undefined"===typeof ib[b.contactId]&&U.subscribeToOpenGroup(b)}b.adminName===y?0===X.deleteChatAccess&&H.removeClass("vis").addClass("n-vis"):
(X.allowInfoAccessGroupMembers||Q.removeClass("vis").addClass("n-vis"),2!==X.deleteChatAccess&&H.removeClass("vis").addClass("n-vis"),X.allowInfoAccessGroupMembers||2===X.deleteChatAccess||J.removeClass("vis").addClass("n-vis"));return!1}return!0};a.addGroupStatus=function(b){var d=a.isGroupLeft(b);if(6!==b.type&&(d||Kb)){if(d)u.onGroupLeft("",{groupId:b.contactId});c.removeClass("mck-tab-title-w-status");E.removeClass("vis").addClass("n-vis")}else if(0<b.members.length){for(var d="",k=!1,h=30>=b.members.length?
b.members.length:25,g=0;g<h;g++)if(y===""+b.members[g]||-1!==b.removedMembersId.indexOf(b.members[g]))k=!0;else var l=e.fetchContact(""+b.members[g]),l=e.getTabDisplayName(l.contactId,!1),d=d+(" "+l+",");if(5!==b.type&&6!==b.type||k&&5!==b.type)d+=" You";30<b.members.length&&(d+=" and "+(b.members.length-25)+" more");d=d.replace(/,\s*$/,"");E.html(d);E.attr("title",d);E.removeClass("n-vis").addClass("vis");c.addClass("mck-tab-title-w-status");Q.removeClass("n-vis").addClass("vis")}else c.removeClass("mck-tab-title-w-status"),
E.removeClass("vis").addClass("n-vis");7===b.type&&(E.html(""),Q.removeClass("vis").addClass("n-vis"))};a.disableGroupTab=function(){C.html(MCK_LABELS["group.chat.disabled"]);C.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");c.removeClass("mck-tab-title-w-status");E.removeClass("vis").addClass("n-vis")};a.isGroupLeft=function(a){var e=!1;a.removedMembersId&&0<a.removedMembersId.length&&b.each(a.removedMembersId,function(a,b){b===y&&(e=!0)});return e};
a.onGroupLeft=function(b,e){q.removeClass("vis").addClass("n-vis");if("object"===typeof b&&"error"===b.status)alert("Unable to process your request. "+b.errorMessage);else{var c=e.groupId;if(s.hasClass("vis")){var d=s.data("mck-id");c===d&&V.trigger("click")}else if(N.hasClass("vis")){var d=P.data("mck-id"),k=P.data("isgroup");d===c.toString()&&k&&(Q.removeClass("vis").addClass("n-vis"),a.disableGroupTab())}}};a.onAddedGroupMember=function(c,d){q.removeClass("vis").addClass("n-vis");if("object"===
typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{var k=d.groupId,h=d.userId,g="";k?g=mckGroupUtils.getGroup(k):d.clientGroupId&&(g=mckGroupUtils.getGroupByClientGroupId(d.clientGroupId));if("object"===typeof g)if(g=a.addMemberToGroup(g,h),s.hasClass("vis")){var l=s.data("mck-id");k===l&&(k=e.fetchContact(""+h),0===b("#li-gm-"+k.htmlId).length&&a.addGroupMember(g,k),a.sortGroupMemberHtmlList(),a.enableGroupAdminMenuToggle())}else N.hasClass("vis")&&(h=P.data("mck-id"),
l=P.data("isgroup"),h===k.toString()&&l&&a.addGroupStatus(g));else mckGroupService.getGroupFeed({groupId:k,clientGroupId:d.clientGroupId,apzCallback:u.onGroupFeed})}};a.onRemovedGroupMember=function(c,d){q.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{var k=d.groupId,h=d.userId,g="";k?g=mckGroupUtils.getGroup(k):d.clientGroupId&&(g=mckGroupUtils.getGroupByClientGroupId(d.clientGroupId));if("object"===typeof g)if(g=
a.removeMemberFromGroup(g,h),s.hasClass("vis"))g=s.data("mck-id"),k===g&&(k=e.fetchContact(""+h),k=b("#li-gm-"+k.htmlId),0<k.length&&k.remove());else{if(N.hasClass("vis")){var h=P.data("mck-id"),l=P.data("isgroup");h===k.toString()&&l&&a.addGroupStatus(g)}}else mckGroupService.getGroupFeed({groupId:k,clientGroupId:d.clientGroupId,apzCallback:u.onGroupFeed})}};a.onGroupFeed=function(c,d){q.removeClass("vis").addClass("n-vis");if("success"===c.status){var k=c.data,g=k.conversationPxy,h=mckGroupUtils.getGroup(k.id);
k.deletedAtTime&&(C.html(MCK_LABELS["group.deleted"]),C.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),l.removeClass("vis").addClass("n-vis"));var z=[];"object"===typeof g&&(O[g.id]=g,oa[g.topicId]=[g.id],g.topicDetail&&(K[g.topicId]=b.parseJSON(g.topicDetail)),z.push(g));0<z.length&&(Z[d.groupId]=z);ba.loadUserProfiles(k.membersId);d.isMessage&&"object"===typeof d.message&&e.populateMessage(d.messageType,d.message,d.notifyUser);d.isReloadTab&&a.reloadGroupTab(h)}};a.onUpdateGroupInfo=
function(e,d){q.removeClass("vis").addClass("n-vis");z.attr("disabled",!1).html("Update");I.removeClass("vis").addClass("n-vis");if("object"===typeof e&&"error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{var k=d.groupId,g=d.groupInfo,h=mckGroupUtils.getGroup(k);if("object"===typeof h){g.imageUrl&&(h.imageUrl=g.imageUrl);g.newName&&(h.displayName=g.newName);g.users&&0<g.users.length&&b.each(g.users,function(a,b){b.userId&&(h.users[b.userId]=b)});if(s.hasClass("vis"))g.imageUrl&&
sa.html(a.getGroupImage(h.imageUrl)),la.html(h.displayName),g.users&&0<g.users.length&&(Bb.html(""),a.addMembersToGroupInfoList(h),h.adminName===y?cb.removeClass("n-vis").addClass("vis"):cb.removeClass("vis").addClass("n-vis"));else if(N.hasClass("vis")){var l=P.data("mck-id"),ra=P.data("isgroup");l===k.toString()&&ra?c.html(h.displayName):0<b("#li-group-"+h.htmlId).length&&(b("#li-group-"+h.htmlId+" .mck-cont-name strong").html(h.displayName),g.imageUrl&&b("#li-group-"+h.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+
h.imageUrl+"'\x3e"))}MCK_GROUP_MAP[h.contactId]=h}}};a.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var e=O[b.conversationId];if("object"!==typeof e||"object"!==typeof K[e.topicId])a.conversationId=b.conversationId}a.apzCallback=u.onGroupFeed;mckGroupService.getGroupFeed(a)}};a.reloadGroupTab=function(b){var e=P.data("mck-id"),c=P.data("isgroup");e===b.contactId.toString()&&c&&a.addGroupStatus(b)};a.loadGroupTab=function(a){"error"===
a.status?alert("Unable to process your request. "+a.errorMessage):(e.loadTab({tabId:a.data.contactId,isGroup:!0}),b("#mck-search").val(""))};a.addMembersToGroupInfoList=function(c){var d=c.members;d.sort();Bb.html("");b.each(d,function(d,k){if(k){var g=e.fetchContact(""+k);0===b("#li-gm-"+g.htmlId).length&&a.addGroupMember(c,g)}});a.sortGroupMemberHtmlList();a.enableGroupAdminMenuToggle()};a.enableGroupAdminMenuToggle=function(){b(".mck-group-member-info").bind("mouseenter",function(){b(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",
function(){b(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};a.addGroupMember=function(a,c){var k="n-vis",l="n-vis",z=a.users[c.contactId],ra="Member",p=3;z&&"undefined"!==typeof z.role&&(p=z.role,ra=d[z.role]);z=e.getTabDisplayName(c.contactId,!1);c.contactId===a.adminName&&(k="vis");a.adminName===y&&(l="vis");c.contactId===y&&(z="You",l="n-vis");var s=e.getContactImageLink(c,z),C="";ha[c.contactId]||(g.MCK_OL_MAP[c.contactId]?C=MCK_LABELS.online:S[c.contactId]&&(C=mckDateUtils.getLastSeenAtStatus(S[c.contactId])));
k=[{roleExpr:ra,roleVal:p,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:c.htmlId,contIdExpr:c.contactId,contImgExpr:s,contLastSeenExpr:C,contNameExpr:z,contFirstAlphaExpr:z.charAt(0).toUpperCase(),isAdminExpr:k,enableAdminMenuExpr:l}];b.tmpl("groupMemberTemplate",k).appendTo("#mck-group-member-list")};a.addMembersToGroupSearchList=function(){var c=P.data("mck-id");if(P.data("isgroup")){var d=mckGroupUtils.getGroup(c),k=Ma,g=[],k=k.filter(function(a,
b){return k.indexOf(a)===b});k.sort();var h=d.members;b.each(k,function(b,c){if(c){var k=e.fetchContact(""+c);if(-1===h.indexOf(k.contactId)||-1!==h.indexOf(k.contactId)&&-1!==d.removedMembersId.indexOf(k.contactId))a.addGroupSearchMember(k),g.push(k)}});a.enableGroupAdminMenuToggle();0<g.length?p.removeClass("vis").addClass("n-vis"):p.removeClass("n-vis").addClass("vis");e.initAutoSuggest({contactsArray:g,$searchId:M,isContactSearch:!1})}D.removeClass("vis").addClass("n-vis")};a.addGroupSearchMember=
function(a){var c=e.getTabDisplayName(a.contactId,!1),d=e.getContactImageLink(a,c),k="user-"+a.htmlId,h="";ha[a.contactId]||(g.MCK_OL_MAP[a.contactId]?h=MCK_LABELS.online:S[a.contactId]&&(h=mckDateUtils.getLastSeenAtStatus(S[a.contactId])));b.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:k,contIdExpr:a.contactId,contImgExpr:d,contLastSeenExpr:h,contNameExpr:c}]).appendTo("#mck-group-member-search-list")};a.loadCreateGroupTab=function(){aa.removeClass("vis").addClass("n-vis");N.removeClass("vis").addClass("n-vis");
x.removeClass("vis").addClass("n-vis");s.removeClass("vis").addClass("n-vis");ta.removeClass("vis").addClass("n-vis");Y.data("iconurl","");L.html("");ma.removeClass("n-vis");qa.html(MCK_LABELS["add.group.icon"]);Y.html(a.getGroupDefaultIcon());k.removeClass("n-vis").addClass("vis")};a.loadGroupInfo=function(b){if(b.groupId){la.attr("contenteditable",!1);B.removeClass("vis").addClass("n-vis");xa.removeClass("n-vis").addClass("vis");aa.removeClass("vis").addClass("n-vis");N.removeClass("vis").addClass("n-vis");
x.removeClass("vis").addClass("n-vis");I.removeClass("vis").addClass("n-vis");k.removeClass("vis").addClass("n-vis");ka.removeClass("vis").addClass("n-vis");da.removeClass("vis").addClass("n-vis");s.removeClass("n-vis").addClass("vis");s.data("mck-id",b.groupId);sa.data("iconurl","");b.conversationId&&s.data("mck-conversation-id",b.conversationId);Bb.html("");var e=mckGroupUtils.getGroup(b.groupId);"object"===typeof e?(sa.html(a.getGroupImage(e.imageUrl)),la.html(e.displayName),a.addMembersToGroupInfoList(e),
e.adminName===y?cb.removeClass("n-vis").addClass("vis"):cb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:u.onGroupFeed})}};a.sortGroupMemberHtmlList=function(){b("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};a.addGroupMemberFromSearch=function(a){var b=s.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var e=mckGroupUtils.getGroup(b);
"object"===typeof e&&y===e.adminName?(ba.loadUserProfile(a),mckGroupService.addGroupMember({groupId:b,userId:a,apzCallback:u.onAddedGroupMember})):$a.removeClass("vis").addClass("n-vis")}W.mckModal("hide")}},ca=new function(){var a=this,d=["CREATE","UPDATE"],g=b("#mck-file-box"),l=b(".mck-overlay"),c=b("#mck-msg-sbmt"),E=b("#mck-text-box"),p=b("#mck-file-input"),D=b(".mck-overlay-box"),u=b(".mck-file-upload"),s=b("#mck-group-icon-upload"),x=b("#mck-group-icon-change"),w=b("#mck-group-info-icon-box"),
y=b("#mck-btn-group-icon-save"),B=b("#mck-message-cell .mck-message-inner"),N=b("#mck-group-create-icon-box"),K=b("#mck-group-info-icon-loading"),F=b("#mck-group-create-icon-loading"),k=b("#mck-group-info-icon-box .mck-group-icon"),aa=b("#mck-group-create-icon-box .mck-group-icon"),z=b("#mck-gc-overlay-label");b.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
a.init=function(){u.on("click",function(){p.trigger("click")});s.on("change",function(){var e=b(this)[0].files[0];a.uplaodFileToAWS(e,d[0]);return!1});x.on("change",function(){var e=b(this)[0].files[0];a.uplaodFileToAWS(e,d[1]);return!1});p.on("change",function(){var e=b(this)[0].files[0],c={};c.file=e;c.name=e.name;a.uploadFile(c)});b(t).on("click",".mck-remove-file",function(){var e=b(this).parents(".mck-file-box"),d=e.data("mckfile");e.remove();c.attr("disabled",!1);0===g.find(".mck-file-box").length&&
(g.removeClass("vis").addClass("n-vis"),E.attr("required",""));"object"===typeof d&&(a.deleteFileMeta(d.blobKey),b.each(J,function(a,b){"undefined"!==typeof b&&b.blobKey===d.blobKey&&J.splice(a,1)}))})};a.uploadFile=function(d){var k=d.file,h=[];if("undefined"!==typeof k)if(4<b(".mck-file-box").length&&h.push("Can't upload more than 5 files at a time"),k.size>1048576*qb&&h.push("file size can not be more than "+qb+" MB"),0<h.length)alert(h.toString());else{var h=mckUtils.randomId(),l=[{fileIdExpr:h,
fileName:d.name,fileNameExpr:'\x3ca href\x3d"#"\x3e'+d.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(k.size)}];b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var z=b(".mck-file-box."+h),p=b(".mck-file-box."+h+" .mck-file-lb"),s=b(".mck-file-box."+h+" .progress .bar"),C=b(".mck-file-box."+h+" .progress"),x=b(".mck-file-box."+h+" .mck-remove-file");s.css("width","0%");C.removeClass("n-vis").addClass("vis");x.attr("disabled",!0);u.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");
if(d.name===b(".mck-file-box."+h+" .mck-file-lb a").html()){var aa=B.data("mck-id");ua[d.name+k.size]=aa;c.attr("disabled",!0);d=[];d.push(k);var D=new XMLHttpRequest;(D.upload||D).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);s.css("width",a+"%")});D.addEventListener("load",function(d){d=b.parseJSON(this.responseText);if("object"===typeof d.fileMeta){d=d.fileMeta;var k=a.getFilePreviewPath(d),g=d.name,h=d.size,l=B.data("mck-id"),g=g+h,h=ua[g];if(aa!==l)e.updateDraftMessage(h,
d),delete ua[g];else return x.attr("disabled",!1),u.attr("disabled",!1),c.attr("disabled",!1),delete ua[g],p.html(k),C.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),E.removeAttr("required"),J.push(d),z.data("mckfile",d),u.children("input").val(""),!1}else x.attr("disabled",!1),c.attr("disabled",!1),x.trigger("click")});b.ajax({type:"GET",url:I+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=
new FormData;b.append("files[]",k);D.open("POST",a,!0);D.send(b)},error:function(){}})}return!1}};a.uplaodFileToAWS=function(a,b){var e=new FormData,c=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&c.push("Please upload image file."),0<c.length?alert(c.toString()):(l.attr("disabled",!0),d[0]===b?(N.find(".mck-overlay-box").removeClass("n-vis"),N.removeClass("mck-hover-on"),F.removeClass("n-vis").addClass("vis")):(w.find(".mck-overlay-box").removeClass("n-vis"),w.removeClass("mck-hover-on"),
K.removeClass("n-vis").addClass("vis")),c=new XMLHttpRequest,c.addEventListener("load",function(a){if(a=this.responseText)d[0]===b?(aa.html('\x3cimg src\x3d"'+a+'"/\x3e'),aa.data("iconurl",a),z.html(MCK_LABELS["change.group.icon"]),F.removeClass("vis").addClass("n-vis"),N.addClass("mck-hover-on")):(k.html('\x3cimg src\x3d"'+a+'"/\x3e'),k.data("iconurl",a),K.removeClass("vis").addClass("n-vis"),w.addClass("mck-hover-on"),setTimeout(function(){y.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){D.addClass("n-vis")},
1500);l.attr("disabled",!1);d[0]===b?s.val(""):x.val("");return!1}),e.append("file",a),c.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),c.setRequestHeader("UserId-Enabled",!0),c.setRequestHeader("Authorization","Basic "+q),c.setRequestHeader("Application-Key",W),c.setRequestHeader("Device-Key",T),ia&&c.setRequestHeader("Access-Token",ia),c.send(e)))};a.deleteFileMeta=function(a){mckUtils.ajax({url:I+"/rest/ws/aws/file/delete?key\x3d"+a,type:"post",success:function(){},error:function(){}})};a.getFilePreviewPath=
function(a){return"object"===typeof a?'\x3ca href\x3d"'+I+"/rest/ws/aws/file"+a.blobKey+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":""};a.getFilePreviewSize=function(a){return a?1048576<a?"("+parseInt(a/1048576)+" MB)":1024<a?"("+parseInt(a/1024)+" KB)":"("+parseInt(a)+" B)":""};a.addFileBox=function(a){var e=mckUtils.randomId(),d="";"object"===typeof a.fileMeta&&(e=a.fileMeta.createdAtTime,d=a.fileMeta.name);b.tmpl("fileboxTemplate",[{fileNameExpr:a.filelb,fileSizeExpr:a.filesize,fileIdExpr:e,
fileName:d}]).appendTo("#mck-file-box");var e=b(".mck-file-box."+e),d=e.find(".mck-remove-file"),k=e.find(".progress");"object"===typeof a.fileMeta?(e.data("mckblob",a.fileMeta.blobKey),E.removeAttr("required"),c.attr("disabled",!1),d.attr("disabled",!1),k.removeClass("vis").addClass("n-vis"),J.push(a.fileMeta)):(c.attr("disabled",!0),d.attr("disabled",!0),k.removeClass("n-vis").addClass("vis"))}},e=new function(){var a=this,d="",l=b("#mck-search"),C=b("#mck-msg-to"),c=b(".mck-file-lb"),E=b(".mck-file-sz"),
p=b("#mck-sidebox"),D=b("#mck-file-box"),q=b("#mck-msg-sbmt"),s=b("#mck-msg-form"),x=b("#mck-text-box"),V=b("#mck-msg-error");b("#mck-show-more");var xa=b("#mck-tab-title"),zb=b("#mck-tab-status"),N=b("#mck-message-cell"),L=b(".mck-typing-box"),F=b("#mck-no-messages"),k=b("#mck-product-box"),aa=b(".mck-product-icon"),z=b(".mck-product-title"),ra=b(".mck-product-subtitle"),Ia=b("#mck-product-box .mck-caret"),Ab=b(".mck-product-rt-up .mck-product-key"),M=b("#mck-contact-search-input-box"),da=b(".mck-product-rt-up .mck-product-value"),
W=b(".mck-product-rt-down .mck-product-key"),ta=b(".mck-product-rt-down .mck-product-value");b("#li-mck-group-info");b("#li-mck-leave-group");var X=b("#mck-group-info-tab"),ea=b("#mck-group-search-tab"),ka=b("#mck-no-search-groups"),$a=b("#mck-group-create-tab"),ga=b("#mck-group-search-list");b("#mck-group-search-tabview");var P=b(".mck-group-menu-options"),la=b(".mck-videocall-btn"),oa=b("#mck-group-search-input"),na=b("#mck-group-search-input-box"),T=b("#mck-contact-search-list"),sa=b("#mck-contacts-content"),
ia=b("#mck-contact-search-tab");b("#mck-contact-search-tabview");var ma=b("#mck-contact-search-input");b("#mck-search-list");var ja=b("#mck-no-search-contacts"),Ca=b("#mck-search-tab-box li a"),Da=b("#mck-search-tabview-box"),fa=b("#mck-sidebox-search"),Cb=b("#mck-contact-loading"),cc=b("#mck-typing-label"),r=b("#mck-price-widget"),Ba=b("#mck-msg-response"),ua=b("#mck_response_text"),Fa=b("#li-mck-block-user"),pa=b("#li-mck-video-call"),f=b("#mck-search-loading"),n=b("#mck-tab-individual"),v=b("#mck-attachfile-box"),
G=b("#mck-attachmenu-box"),Na=b("#mck-sidebox-content"),R=b("#mck-tab-option-panel"),Vb=b("#mck-tab-conversation"),db=b("#mck-conversation-header"),dc=b("#mck-no-conversations"),Ta=b("#mck-conversation-list"),Pa=b(".mck-tab-message-option"),Qa=b(".mck-box-ft .mck-box-form"),Wb=b("#mck-btn-clear-messages"),Db=b("#mck-offline-message-box"),A=b("#mck-message-cell .mck-message-inner");b("#mck-msg-new");var Ka=RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);
b.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');b.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
b.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.openConversation=function(){"none"===p.css("display")&&(b(".mckModal").mckModal("hide"),p.mckModal());C.focus()};a.initEmojis=function(){try{b("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(m){d||(d=setTimeout(function(){a.initEmojis()},3E4))}};a.loadTab=function(m,f){var c=A.data("mck-id");if(c)if(1<x.html().length||D.hasClass("vis")){var d={text:x.html(),files:[]};D.hasClass("vis")&&b(".mck-file-box").each(function(){var a=b(this),m={filelb:a.find(".mck-file-lb").html(),
filesize:a.find(".mck-file-sz").html()},a=a.data("mckfile");"object"===typeof a&&(m.fileMeta=a);d.files.push(m)});Ha[c]=d}else delete Ha[c];za=!0;a.clearMessageField(!1);a.addDraftMessage(m.tabId);V.html("");V.removeClass("vis").addClass("n-vis");ua.html("");Ba.removeClass("vis").addClass("n-vis");s[0].reset();s.removeClass("n-vis").addClass("vis");A.html("");V.removeClass("mck-no-mb");sa.removeClass("n-vis").addClass("vis");Qa.removeClass("vis").addClass("n-vis");fa.removeClass("vis").addClass("n-vis");
X.removeClass("vis").addClass("n-vis");$a.removeClass("vis").addClass("n-vis");Na.removeClass("n-vis").addClass("vis");k.removeClass("vis").addClass("n-vis");db.addClass("n-vis");Cb.removeClass("vis").addClass("n-vis");A.removeClass("mck-group-inner");zb.removeClass("vis").addClass("n-vis");xa.removeClass("mck-tab-title-w-status");xa.removeClass("mck-tab-title-w-typing");L.removeClass("vis").addClass("n-vis");cc.html(MCK_LABELS.typing);A.data("isgroup",m.isGroup);A.data("datetime","");if(m.tabId)C.val(m.tabId),
A.data("mck-id",m.tabId),A.data("mck-conversationid",m.conversationId),A.data("mck-topicid",m.topicId),R.data("tabId",m.tabId),R.removeClass("n-vis").addClass("vis"),sa.removeClass("vis").addClass("n-vis"),Qa.removeClass("n-vis").addClass("vis"),Wb.removeClass("n-vis").addClass("vis"),P.removeClass("vis").addClass("n-vis"),m.isGroup?(A.addClass("mck-group-inner"),Fa.removeClass("vis").addClass("n-vis"),pa.removeClass("vis").addClass("n-vis"),la.removeClass("vis").addClass("n-vis")):(Fa.removeClass("n-vis").addClass("vis"),
pa.removeClass("n-vis").addClass("vis"),Ja&&la.removeClass("n-vis").addClass("vis")),!m.topicId&&m.conversationId&&(c=O[m.conversationId],"object"===typeof c&&(m.topicId=c.topicId)),m.topicId&&(c=K[m.topicId],"object"===typeof c&&(qa?(A.data("mck-title",c.title),db.html(c.title),db.removeClass("n-vis")):Ga&&(a.setProductProperties(c,m.topicId),Ia.addClass("n-vis"),k.addClass("mck-product-box-wc"),Ta.addClass("n-vis"),k.removeClass("n-vis").addClass("vis")))),lb&&g.google&&"object"===typeof g.google.maps?
(v.removeClass("vis").addClass("n-vis"),G.removeClass("n-vis").addClass("vis")):(G.removeClass("vis").addClass("n-vis"),v.removeClass("n-vis").addClass("vis")),c=a.getTabDisplayName(m.tabId,m.isGroup,m.userName),a.isGroupDeleted(m.tabId,m.isGroup)&&(V.html(MCK_LABELS["group.deleted"]),V.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),s.removeClass("vis").addClass("n-vis")),xa.html(c),xa.attr("title",c),Vb.removeClass("vis").addClass("n-vis"),Da.removeClass("vis").addClass("n-vis"),n.removeClass("n-vis").addClass("vis"),
"support"===hb&&b(".mck-tab-link").removeClass("vis").addClass("n-vis"),tb&&(r.removeClass("n-vis").addClass("vis"),A.addClass("mck-msg-w-panel")),Ua&&(V.html("Deactivated"),V.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),s.removeClass("vis").addClass("n-vis")),U.subscibeToTypingChannel(m.tabId,m.isGroup),"function"===typeof pb&&pb({tabId:m.tabId,isGroup:m.isGroup});else if(m.tabId="",Xa&&e.hideOfflineMessage(),n.removeClass("vis").addClass("n-vis"),Vb.removeClass("n-vis").addClass("vis"),
Da.removeClass("n-vis").addClass("vis"),k.removeClass("vis").addClass("n-vis"),A.data("mck-id",""),A.data("mck-conversationid",""),A.data("mck-topicid",""),r.removeClass("vis").addClass("n-vis"),A.removeClass("mck-msg-w-panel"),R.removeClass("vis").addClass("n-vis"),Wb.removeClass("vis").addClass("n-vis"),C.val(""),c=B.getLatestMessageArray(),U.unsubscibeToTypingChannel(),null!==c&&0<c.length){m.isReload=!0;e.addContactsFromMessageList({message:c},m);a.openConversation();za=!1;return}w.loadMessageList(m,
f);a.openConversation()};a.setProductProperties=function(b,f){z.html(b.title);aa.html(a.getTopicLink(b.link));ra.html(b.subtitle?b.subtitle:"");var e=b.value1?":"+b.value1:"";Ab.html(b.key1?b.key1:"");da.html(e);e=b.value2?":"+b.value2:"";W.html(b.key2?b.key2:"");ta.html(e);"function"===typeof mb&&(b.topicId=f,mb(b))};a.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};a.processMessageList=function(m,f,c){var n,d=A.children("div[name\x3d'message']:first"),
k=A.data("mck-id"),v=A.data("isgroup")?mckGroupUtils.getGroup(k):e.fetchContact(k);"undefined"===typeof m.message.length?(k=[],k.push(m.message),B.updateMckMessageArray(k),a.addMessage(m.message,v,!1,!1,c),n=m.createdAtTime):(B.updateMckMessageArray(m.message),b.each(m.message,function(b,m){"undefined"!==typeof m.to&&(a.addMessage(m,v,!1,!1,c),n=m.createdAtTime)}));R.data("datetime",n);!f&&0<d.length?A.scrollTop(d.offset().top-A.offset().top+A.scrollTop()):f&&A.animate({scrollTop:A.prop("scrollHeight")},
"fast")};a.closeConversation=function(a){if("function"===typeof ob){var b=ob();if("object"===typeof b)var f="BUSY_WITH_OTHER"===a?b.onBusyWithOtherUser:b.onConversationClose}f||(f="Chat disabled with user");V.html(f);V.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");s.removeClass("vis").addClass("n-vis")};a.addTooltip=function(a){b("."+a+" .mck-icon-time").attr("title","pending");b("."+a+" .mck-btn-trash").attr("title","delete");b("."+a+" .mck-icon-sent").attr("title","sent");b("."+a+" .mck-btn-forward").attr("title",
"forward message");b("."+a+" .mck-icon-delivered").attr("title","delivered");b("."+a+" .mck-icon-read").attr("title","delivered and read");b("."+a+" .msgtype-outbox-cr").attr("title","sent via Carrier");b("."+a+" .msgtype-outbox-mck").attr("title","sent");b("."+a+" .msgtype-inbox-cr").attr("title","received via Carrier");b("."+a+" .msgtype-inbox-mck").attr("title","recieved")};a.fetchContact=function(b){var f=a.getContact(b);"undefined"===typeof f&&(f=a.createContact(b));return f};a.getContact=function(a){if("object"===
typeof ya[a])return ya[a]};a.getContactDisplayName=function(a){if("string"===typeof va[a])return va[a]};a.addMessage=function(m,f,c,n,d){var k="",v="",h="",G="vis",l="n-vis",z="",p="n-vis";if("object"===typeof m.metadata&&"undefined"!==typeof m.metadata.AL_REPLY&&(k=m.metadata.AL_REPLY,v=w.getReplyMessageByKey(k),"undefined"!==typeof v)){if(f.isGroup&&v||!f.isGroup&&"undefined"===typeof v.fileMeta)p="vis";z=5===v.type?"You":e.getTabDisplayName(v.to,!1);if("object"===typeof v.fileMeta||2===v.contentType)h=
a.getImageForReplyMessage(v),G="n-vis",l="vis",p="n-vis"}if(6!==m.type&&7!==m.type&&!(m.metadata&&"HIDDEN"===m.metadata.category||102===m.contentType||10===m.contentType&&m.metadata&&"true"===m.metadata.hide||0<b("#mck-message-cell ."+m.key).length)){F.hasClass("vis")&&F.removeClass("vis").addClass("n-vis");var s="mck-msg-right",Na="mck-icon-time";if(0===m.type||4===m.type||6===m.type)s="mck-msg-left";if(4===m.contentType||10===m.contentType||103===m.contentType)s="mck-msg-center";var Na=a.getStatusIconName(m),
k=m.key,C="'"+m.deviceKey+"','"+m.to+"','"+m.to+"','"+k+"'",R="",x="",E="",aa="n-vis",ra="";ba.loadUserProfile(m.to);!m.groupId||4===m.contentType||7===f.type||0!==m.type&&4!==m.type&&6!==m.type||(R=a.getTabDisplayName(m.to,!1),aa="vis",E=a.getNameTextClassByAlphabet(R));if(Jb){var ra="mck-msg-avator-bubble",r="",D=R;"mck-msg-right"===s?(r=e.fetchContact(y),D=a.getTabDisplayName(r.displayName,!1)):"mck-msg-left"===s&&(r=m.groupId?e.fetchContact(m.to):f);r&&(x=a.getContactImageLink(r,D))}m.groupId&&
10===m.contentType&&(E=x=R="");f="n-vis";var D=r="",Qa=m.message;"object"===typeof m.fileMeta&&(r=m.fileMeta.name,D=m.fileMeta.size);"object"===typeof m.fileMeta&&(m.fileMeta.contentType.indexOf("audio")||m.fileMeta.contentType.indexOf("image")||m.fileMeta.contentType.indexOf("video"))&&(f="vis");var q="n-vis";ab&&g.MCK_OL_MAP[m.to]&&10!==m.contentType&&(q="vis");h=[{msgReply:v?v.message+"\n":"",msgReplyTo:v?z+"\n":"",msgReplyDivExpr:v?"vis":"n-vis",msgReplyToVisibleExpr:p,msgPreview:h?a.getImageForReplyMessage(v):
"",msgpreviewvisExpr:l,textreplyVisExpr:G,msgKeyExpr:m.key,msgDeliveredExpr:m.delivered,msgSentExpr:m.sent,msgCreatedAtTime:m.createdAtTime,msgTypeExpr:m.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgSourceExpr:m.source,statusIconExpr:Na,contactExpr:"vis",toExpr:m.to,msgAvatorClassExpr:ra,showNameExpr:aa,msgNameExpr:R,msgImgExpr:x,nameTextExpr:E,msgFloatExpr:s,replyIdExpr:k,createdAtTimeExpr:mckDateUtils.getDate(m.createdAtTime),msgFeatExpr:"n-vis",
replyMessageParametersExpr:C,downloadMediaUrlExpr:a.getFileAttachment(m),msgClassExpr:"",msgExpr:Qa,selfDestructTimeExpr:m.timeToLive,fileMetaKeyExpr:m.fileMetaKey,downloadIconVisibleExpr:f,fileExpr:a.getFilePath(m),fileUrlExpr:a.getFileurl(m),fileNameExpr:r,fileSizeExpr:D,contOlExpr:q}];c?b.tmpl("messageTemplate",h).appendTo("#mck-message-cell .mck-message-inner"):b.tmpl("messageTemplate",h).prependTo("#mck-message-cell .mck-message-inner");h="";m.message&&(h=m.message.replace(/\n/g,"\x3cbr/\x3e"),
null!==g.emoji&&"undefined"!==typeof g.emoji&&(h=g.emoji.replace_unified(h),h=g.emoji.replace_colons(h)));m.conversationId&&(G=O[m.conversationId],"object"!==typeof G&&w.getTopicId({conversationId:m.conversationId}),c&&(A.data("mck-conversationid",m.conversationId),G&&(l=K[G.topicId],"object"===typeof l&&(Ga?a.setProductProperties(l,G.topicId):qa&&db.html(l.title)))));4===m.contentType&&(G=h,h="Final agreed price: "+h,tb||(h+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+
G+'" data-mck-conversationid\x3d"'+m.conversationId+'"\x3eAccept\x3c/button\x3e'));G=b("."+k+" .mck-msg-content");if(-1===h.indexOf("emoji-inner")&&0===m.contentType)for(h=h.split("\x3cbr/\x3e"),l=0;l<h.length;l++)z=t.createElement("div"),z.appendChild(t.createTextNode(h[l])),h[l]&&h[l].match(Ka)&&(z=b(z).linkify({target:"_blank"})),G.append(z);else G.html(h),G.linkify({target:"_blank"});m.fileMeta&&(b("."+k+" .mck-file-text a:first").trigger("click"),b("."+k+" .mck-file-text").removeClass("n-vis").addClass("vis"),
""===G.html()&&G.removeClass("vis").addClass("n-vis"));2===m.contentType&&(G.removeClass("vis").addClass("n-vis"),b("."+k+" .mck-file-text").removeClass("n-vis").addClass("vis"));n&&A.animate({scrollTop:A.prop("scrollHeight")},"fast");Pa.hasClass("n-vis")&&(m.groupId?6!==mckGroupUtils.getGroup(m.groupId).type&&Pa.removeClass("n-vis").addClass("vis"):Pa.removeClass("n-vis").addClass("vis"));a.addTooltip(m.key);4!==m.contentType&&10!==m.contentType&&d&&a.messageContextMenu(m.key);m.groupId&&10===m.contentType&&
c&&mckGroupService.getGroupFeed({groupId:m.groupId,isReloadTab:!0,apzCallback:u.onGroupFeed})}};a.addContactForSearchList=function(m,f){var e=m.userCount,c=m.isGroup,n=a.getTabDisplayName(m.contactId,c),d=a.getContactImageLink(m,n),k=c?"gs-group-"+m.htmlId:"cs-user-"+m.htmlId,v="",h=c&&vb;b("#li-"+k+" .mck-group-count-text").html(e);c||ha[m.contactId]||(g.MCK_OL_MAP[m.contactId]?v=MCK_LABELS.online:S[m.contactId]&&(v=mckDateUtils.getLastSeenAtStatus(S[m.contactId])));b.tmpl("searchContactbox",[{contHtmlExpr:k,
contIdExpr:m.contactId,contTabExpr:m.isGroup,contImgExpr:d,contLastSeenExpr:v,contNameExpr:n,groupUserCountExpr:m.userCount,displayGroupUserCountExpr:h?"vis":"n-vis"}]).prependTo("#"+f)};a.getFileurl=function(a){return"object"===typeof a.fileMeta?I+"/rest/ws/aws/file/"+a.fileMeta.blobKey:""};a.getFilePath=function(a){if(2===a.contentType)try{var f=b.parseJSON(a.message);if(f.lat&&f.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+f.lat+","+f.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+"\x26key\x3d"+Ib+'"/\x3e\x3c/a\x3e'}catch(e){if(-1!==a.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+a.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+a.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.message+"\x26key\x3d"+Ib+'" /\x3e\x3c/a\x3e'}return"object"===
typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?-1!==a.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+'" data-url\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===a.contentType?'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
a.fileMeta.contentType+'" data-url\x3d"'+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+'" data-url\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':
-1!==a.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3ca href\x3d"#"\x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+
'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};a.getImageForMessagePreview=function(a){if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+
'" class\x3d"mck-image-reply move-right"/\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ca.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ca.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};a.getImageForReplyMessage=function(a){var f=
e.getTabDisplayName(a.to,!1);if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+f+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':
-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+f+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ca.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+f+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ca.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+f+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};a.getFileAttachment=function(a){if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")||-1!==a.fileMeta.contentType.indexOf("audio")||a.fileMeta.contentType.indexOf("video"),'\x3ca href\x3d"'+I+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" role\x3d"link" class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ca.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e"};a.getFileIcon=function(a){return a.fileMetaKey&&"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e':
-1!==a.fileMeta.contentType.indexOf("video")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e':'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e':""};a.getContactFromGroupOfTwo=function(a){for(var b=0;b<a.members.length;b++)if(y!==""+a.members[b])return e.fetchContact(""+a.members[b])};a.getContactImageLink=function(b,f){var e="";if(b.isGroup&&7!==b.type)e=u.getGroupImage(b.imageUrl);else{b.isGroup&&7===
b.type&&1<b.members.length&&(b=a.getContactFromGroupOfTwo(b));if("function"===typeof Wa){var c=Wa(b.contactId);c&&"undefined"!==typeof c&&(e='\x3cimg src\x3d"'+c+'"/\x3e')}e||(b.photoSrc?e='\x3cimg src\x3d"'+b.photoSrc+'"/\x3e':b.photoData?e='\x3cimg src\x3d"data:image/jpeg;base64,'+b.photoData+'"/\x3e':b.photoLink?e='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+b.photoLink+'"/\x3e':(f||(f=b.displayName),e=a.getContactImageByAlphabet(f)))}return e};a.getContactImageByAlphabet=function(a){if("undefined"===
typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};a.getNameTextClassByAlphabet=function(a){if("undefined"===
typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};a.addContactsFromMessageList=function(f,e){var c;F.removeClass("vis").addClass("n-vis");if("null"===f+"")c="";else if(dc.removeClass("vis").addClass("n-vis"),0==A.has(b("#mck-contact-list")).length&&A.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?
(f.message.groupId?a.addGroupFromMessage(f.message):a.addContactsFromMessage(f.message),c=f.message.createdAtTime):b.each(f.message,function(b,f){"undefined"!==typeof f.to&&(f.groupId?a.addGroupFromMessage(f,!0):a.addContactsFromMessage(f,!0),c=f.createdAtTime)}),A.data("datetime",c),e.isReload){var n="";e.lastActiveTabId&&(n=e.isLastActiveTabGroup?"group-"+e.lastActiveTabId:"user-"+mckContactUtils.formatContactId(e.lastActiveTabId),n=b("#li-"+n));0<n.length?A.animate({scrollTop:n.offset().top-A.offset().top+
A.scrollTop()},"fast"):A.animate({scrollTop:0},0)}};a.addGroupFromMessageList=function(f,e){"null"!==f+""&&(e&&A.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?a.addGroupFromMessage(f.message):b.each(f.message,function(b,f){"undefined"!==typeof f.to&&a.addGroupFromMessage(f,!0)}))};a.createContact=function(b){var f=a.getContactDisplayName(b);"undefined"===typeof f&&(f=b);f={contactId:b,htmlId:mckContactUtils.formatContactId(b),
displayName:f,name:f+" \x3c"+b+"\x3e [Main]",value:b,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return ya[b]=f};a.createContactWithDetail=function(b){var f=b.displayName,e=b.userId;f||(f=a.getContactDisplayName(e));"undefined"===typeof f?f=e:va[e]=f;var c=b.photoLink?b.photoLink:"";c||(c=b.imageLink?b.imageLink:"");b=b.imageData?b.imageData:"";f={contactId:e,htmlId:mckContactUtils.formatContactId(e),displayName:f,name:f+" \x3c"+e+"\x3e [Main]",value:e,photoLink:"",photoSrc:c,
photoData:b,email:"",unsaved:!0,isGroup:!1};return ya[e]=f};a.updateContactDetail=function(b,f){var e=f.displayName,c=f.userId;b.displayName&&b.displayName!==b.contactId||(e||(e=a.getContactDisplayName(c)),"undefined"===typeof e?e=c:va[c]=e,b.displayName=e);(e=f.photoLink)||(e=f.imageLink?f.imageLink:"");e&&!b.photoSrc&&(b.photoSrc=e);(e=f.imageData?f.imageData:"")&&!b.photoData&&(b.photoData=e);return ya[c]=b};a.addContactsFromMessage=function(b,f){var e=a.getUserIdFromMessage(b);if(0<e.length&&
e[0])for(var c=0;c<e.length;c++){var n=a.fetchContact(""+e[c]);a.updateRecentConversationList(n,b,f)}};a.addGroupFromMessage=function(b,f){var e=b.groupId,c=mckGroupUtils.getGroup(""+e);"undefined"===typeof c&&(c=mckGroupUtils.createGroup(e),mckGroupService.loadGroups({apzCallback:u.loadGroups}));a.updateRecentConversationList(c,b,f)};a.updateRecentConversationList=function(f,e,c){0<b("#mck-contact-list #li-"+(f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId)).length?(b("#mck-contact-list #li-"+f.htmlId+
" .mck-cont-msg-wrapper").is(":empty")||c)&&void 0!==e&&a.updateContact(f,e,"mck-contact-list"):a.addContact(f,"mck-contact-list",e)};a.addContactsToSearchList=function(){var e=[],c=[];b.each(La,function(a,b){c.push(b.contactId)});var n=c.filter(function(a,b){return c.indexOf(a)===b});n.sort();f.removeClass("vis").addClass("n-vis");0<n.length?b.each(n,function(f,c){if(c){var n=a.fetchContact(""+c);e.push(n);0===b("#li-cs-user-"+n.htmlId).length&&a.addContactForSearchList(n,"mck-contact-search-list")}}):
ja.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:e,$searchId:ma,isContactSearch:!0})};a.initAutoSuggest=function(f){for(var c=f.contactsArray,n=f.$searchId,d=[],k,v={},h=[],g=0;g<c.length;g++){var G=c[g];G.displayName=a.getTabDisplayName(G.contactId,G.isGroup);k=G.displayName?b.trim(G.displayName):b.trim(G.contactId);v[k]=G;d.push(k);h.push(k)}c=function(a){a=v[a];var b=a.displayName.split(" "),f=b.length,e=b[0],m="",c="";2===f?c=b[1]:3<=f&&(c=b[f-1],m=b[f-2]);b=RegExp(this.query,
"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(m)||b.test(c)||b.test(a.email)||b.test(e+" "+c)};k=function(a){return v[a].displayName};h=function(a){a=v[a];f.isContactSearch?(e.loadTab({tabId:a.contactId,isGroup:a.isGroup}),Qa.removeClass("n-vis").addClass("vis")):u.addGroupMemberFromSearch(a.contactId)};n.hasClass("mck-typeahead")?(n.mcktypeahead().data("mcktypeahead").source=d,n.mcktypeahead().data("mcktypeahead").matcher=c,n.mcktypeahead().data("mcktypeahead").highlighter=k,n.mcktypeahead().data("mcktypeahead").updater=
h):(n.addClass("mck-typeahead"),n.mcktypeahead({source:d,matcher:c,highlighter:k,updater:h}))};a.initSearchAutoType=function(){Sb&&(ma.keypress(function(a){if(13===a.which){if(a=ma.val())if(a="undefined"!==typeof a&&""!==a?a.toString():"")e.loadTab({tabId:a,isGroup:!1,isSearch:!0}),Qa.removeClass("n-vis").addClass("vis");ma.val("")}}),oa.keypress(function(a){if(13===a.which)return!0}),b(t).on("click",".mck-group-search-link",function(a){a.preventDefault();return!0}),b(t).on("click",".mck-contact-search-link",
function(a){a.preventDefault();a=ma.val();""!==a&&(e.loadTab({tabId:a,isGroup:!1,isSearch:!0}),Qa.removeClass("n-vis").addClass("vis"));ma.val("")}))};a.removeContact=function(a){b("#li-"+(a.isGroup?"group-"+a.htmlId:"user-"+a.htmlId)).remove()};a.updateContact=function(f,e,c){var n=f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId,d=b("#li-"+n),k=d.data("msg-time");if(e&&e.createdAtTime>k){k=a.getUnreadCount(e.groupId?"group_"+f.contactId:"user_"+f.contactId);f=a.getMessageTextForContactPreview(e,f,15);
b("#li-"+n+" .mck-cont-msg-date").html("undefined"===typeof e.createdAtTime?"":mckDateUtils.getTimeOrDate(e?e.createdAtTime:"",!0));var v=b("#li-"+n+" .mck-cont-msg-wrapper");v.html("");"object"===typeof f?v.append(f):v.html(f);e.conversationId&&(f=e.conversationId,v=O[f],"object"===typeof v&&(v=v.topicId)&&qa&&(v=K[v],"object"===typeof v&&b("#li-"+n+" .mck-conversation-topic").html(v.title)),b("#li-"+n+" a").data("mck-conversationid",f));0<k&&(b("#li-"+n+" .mck-unread-count-text").html(k),b("#li-"+
n+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));n=b("#"+c+" li:nth-child(1)").data("msg-time");d.data("msg-time",e.createdAtTime);("undefined"===typeof n||(e?e.createdAtTime:"")>=n)&&0!==b("#mck-contact-list li").index(d)&&b("#"+c+" li:nth-child(1)").before(d)}};a.clearContactMessageData=function(a,f){var e=mckContactUtils.formatContactId(a),e=f?"group-"+e:"user-"+e;b("#li-"+e+" .mck-cont-msg-date").html("");b("#li-"+e+" .mck-cont-msg-wrapper").html("")};a.addContact=function(f,
c,n){var d=a.getMessageTextForContactPreview(n,f,100),k=f.userCount,v="",h=!1;if("undefined"!==typeof n){if(n.conversationId)var v=n.conversationId,G=O[v];n.groupId&&(h=!0)}var l=a.getTabDisplayName(f.contactId,h),z=a.getContactImageLink(f,l),p=!1,s=a.getUnreadCount(h?"group_"+f.contactId:"user_"+f.contactId),Na=0<s&&"mck-search-list"!==c?"vis":"n-vis",C="n-vis",R=h?"group-"+f.htmlId:"user-"+f.htmlId,x=h&&vb;b("#li-"+R+" .mck-group-count-text").html(k);b("#li-"+R+" .mck-group-count-box").removeClass("n-vis").addClass("vis");
h||ha[f.contactId]||Aa[f.contactId]||!ab||!g.MCK_OL_MAP[f.contactId]||(C="vis",p=!0);7===f.type&&1<f.members.length&&(R=mckGroupUtils.getGroup(n.groupId),R=e.getContactFromGroupOfTwo(R),h&&ab&&g.MCK_OL_MAP[R.contactId]&&(C="vis",p=!0));k="n-vis";if("object"===typeof G&&qa&&(G=K[G.topicId],"object"===typeof G))var k="vis",E=G.title;R=h?"group-"+f.htmlId:"user-"+f.htmlId;f=[{contHtmlExpr:R,contIdExpr:f.contactId,contTabExpr:h,msgCreatedAtTimeExpr:n?n.createdAtTime:"",mckLauncherExpr:Ra,contImgExpr:z,
contOlExpr:C,onlineLabel:MCK_LABELS.online,contUnreadExpr:Na,contUnreadCount:s,contNameExpr:l,conversationExpr:v,contHeaderExpr:k,titleExpr:E,groupUserCountExpr:h?f.userCount:"",displayGroupUserCountExpr:x?"vis":"n-vis",msgCreatedDateExpr:n?mckDateUtils.getTimeOrDate(n.createdAtTime,!0):""}];v=b("#"+c+" li:nth-child(1)").data("msg-time");"undefined"===typeof v||(n?n.createdAtTime:"")>=v||-1!==c.indexOf("search")&&p?b.tmpl("contactTemplate",f).prependTo("#"+c):b.tmpl("contactTemplate",f).appendTo("#"+
c);c=b("#li-"+R+" .msgTextExpr");"object"===typeof d?c.append(d):c.html(d)};a.addContactsToContactSearchList=function(){ja.removeClass("vis").addClass("n-vis");ka.removeClass("vis").addClass("n-vis");ia.hasClass("active")||(Ca.removeClass("active"),ia.addClass("active"));ga.removeClass("vis").addClass("n-vis");T.removeClass("n-vis").addClass("vis");na.removeClass("vis").addClass("n-vis");M.removeClass("n-vis").addClass("vis");T.html("");sa.removeClass("vis").addClass("n-vis");Na.removeClass("vis").addClass("n-vis");
X.removeClass("vis").addClass("n-vis");$a.removeClass("vis").addClass("n-vis");fa.removeClass("n-vis").addClass("vis");f.removeClass("n-vis").addClass("vis");0!==La.length?e.addContactsToSearchList():wb?(f.removeClass("vis").addClass("n-vis"),ja.removeClass("n-vis").addClass("vis")):ba.loadContacts();ma.focus()};a.addGroupsToGroupSearchList=function(){var e=[],c=[];ja.removeClass("vis").addClass("n-vis");ka.removeClass("vis").addClass("n-vis");ea.hasClass("active")||(Ca.removeClass("active"),ea.addClass("active"));
T.removeClass("vis").addClass("n-vis");ga.removeClass("n-vis").addClass("vis");M.removeClass("vis").addClass("n-vis");na.removeClass("n-vis").addClass("vis");ga.html("");sa.removeClass("vis").addClass("n-vis");Na.removeClass("vis").addClass("n-vis");X.removeClass("vis").addClass("n-vis");$a.removeClass("vis").addClass("n-vis");fa.removeClass("n-vis").addClass("vis");f.removeClass("n-vis").addClass("vis");if(0<Ya.length){b.each(Ya,function(a,b){c.push(b.contactId)});var n=c.filter(function(a,b){return c.indexOf(a)===
b});n.sort();b.each(n,function(f,c){if(c){var n=mckGroupUtils.getGroup(""+c);e.push(n);0===b("#li-gs-group-"+n.htmlId).length&&a.addContactForSearchList(n,"mck-group-search-list")}})}else ka.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:e,$searchId:oa,isContactSearch:!0});f.removeClass("vis").addClass("n-vis")};a.addConversationMenu=function(a,f){var e=A.data("mck-id");Ta.html("");a===e&&(e=Z[a],"undefined"===typeof e||0===e.length||1===e.length?(Ia.addClass("n-vis"),k.addClass("mck-product-box-wc"),
Ta.addClass("n-vis")):(Ta.removeClass("n-vis"),Ia.removeClass("n-vis"),k.removeClass("mck-product-box-wc"),b.each(e,function(e,c){if(0===b("#mck-conversation-list #li-"+c.id).length){var n="";c.topicDetail&&(n=b.parseJSON(c.topicDetail),n="object"===typeof n?n.title:c.topicDetail);n||(n=c.topicId);b.tmpl("convTemplate",[{convIdExpr:c.id,tabIdExpr:a,isGroupExpr:f,topicIdExpr:c.topicId,convTitleExpr:n,mckLauncherExpr:Ra}]).appendTo(Ta)}}),2>b("#mck-conversation-list li").length&&(Ia.addClass("n-vis"),
k.addClass("mck-product-box-wc"),Ta.addClass("n-vis"))))};a.loadContacts=function(f){"null"!==f+""&&"undefined"!==typeof f&&"undefined"!==typeof f.contacts&&0!==f.contacts.length&&(La.length=0,Ma.length=0,b.each(f.contacts,function(b,f){if("undefined"!==typeof f.userId){var e=a.getContact(""+f.userId),e="undefined"===typeof e?a.createContactWithDetail(f):a.updateContactDetail(e,f);La.push(e);Ma.push(e.contactId)}}))};a.getStatusIcon=function(b){return'\x3cspan class\x3d"'+a.getStatusIconName(b)+" move-right "+
b.key+'_status status-icon"\x3e\x3c/span\x3e'};a.getStatusIconName=function(a){return 7===a.type||6===a.type||4===a.type||0===a.type?"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||1===a.source)?"mck-icon-sent":""};a.clearMessageField=function(a){x.html("");q.attr("disabled",!1);D.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html("");a?x.focus().select():(l.blur(),x.blur())};a.addDraftMessage=
function(a){J=[];a&&"object"===typeof Ha[a]?(a=Ha[a],x.html(a.text),0<a.files.length&&(b.each(a.files,function(a,b){ca.addFileBox(b)}),c.html(a.filelb),E.html(a.filesize),D.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):J=[]};a.showOfflineMessage=function(){"object"===typeof Y&&Y.innerHTML?(Db.html(Y.innerHTML),Db.removeClass("n-vis").addClass("vis")):g.console.log("Offline message innerHTML required.")};a.hideOfflineMessage=function(){Sa.stopOfflineMessageCounter();
Db.removeClass("vis").addClass("n-vis")};a.removeConversationThread=function(a,f){B.clearMckMessageArray();var c=f?mckGroupUtils.getGroup(a):e.getContact(a),n=A.data("mck-id"),d=A.data("isgroup");"undefined"===typeof n||""===n?(c="undefined"!==typeof c?c.htmlId:mckContactUtils.formatContactId(a),b("#li-"+(f?"group-"+c:"user-"+c)).remove()):n===a&&d===f&&(R.data("datetime",""),F.removeClass("n-vis").addClass("vis"),N.removeClass("n-vis").addClass("vis"),Pa.removeClass("vis").addClass("n-vis"))};a.removedDeletedMessage=
function(a,f,e){B.clearMckMessageArray();a=b("."+a);0<a.length?(a.remove(),A.is(":empty")&&(N.removeClass("n-vis").addClass("vis"),Pa.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof f&&0<b("#mck-contact-list").length&&w.updateContactList(f,e)};a.getMessageTextForContactPreview=function(a,b,f){var c="";if("undefined"!==typeof a){if(a.message)if(2===a.contentType)c='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{c=a.message;if(mckUtils.startsWith(c,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';
null!==g.emoji&&"undefined"!==typeof g.emoji&&(c=g.emoji.replace_unified(c),c=g.emoji.replace_colons(c),c=-1!==c.indexOf("\x3c/span\x3e")?c.substring(0,c.lastIndexOf("\x3c/span\x3e")):c.substring(0,f));b.isGroup||-1!==c.indexOf("emoji-inner")||0!==a.contentType||(f=t.createElement("p"),f.appendChild(t.createTextNode(c)),c=f)}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(c=e.getFileIcon(a));b.isGroup&&3!==b.type&&7!==b.type&&(b=a.to.split(",")[0]===y?"Me":e.getTabDisplayName(a.to.split(",")[0],
!1),10!==a.contentType&&(c=b+": "+c),-1===c.indexOf("emoji-inner")&&a&&a.message&&0===a.contentType&&(f=t.createElement("p"),f.appendChild(t.createTextNode(c)),c=f))}return c};a.getTextForMessagePreview=function(a,f){var c="";if("undefined"!==typeof a){if(2===a.contentType)c="Shared location";else if(a.message)if(c=a.message,mckUtils.startsWith(c,"\x3cimg"))c="Image attachment";else{var n=t.createElement("div");n.innerHTML=c;c=b.trim(mckUtils.textVal(n));c=c.substring(0,50)}else a.fileMetaKey&&"object"===
typeof a.fileMeta&&(c=-1!==a.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");f.isGroup&&3!==f.type&&7!==f.type&&(c=(a.to.split(",")[0]===y?"Me":e.getTabDisplayName(a.to.split(",")[0],!1))+": "+c)}return c};a.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};a.getUserIdArrayFromMessageList=function(f){var e=[];"undefined"===typeof f.length?e.concat(a.getUserIdFromMessage(f)):b.each(f,function(b,f){"undefined"!==
typeof f.to&&(e=e.concat(a.getUserIdFromMessage(f)))});return e};a.messageContextMenu=function(a){var f=b("."+a+" .mck-msg-box");f.addEventListener?f.addEventListener("contextmenu",function(a){a.preventDefault()},!1):f.bind("contextmenu",function(f){f.preventDefault();b(".mck-context-menu").removeClass("vis").addClass("n-vis");b("."+a+" .mck-context-menu").removeClass("n-vis").addClass("vis");g.event.returnValue=!1})};a.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||
"ARCHIVE"===a.metadata.category?!1:!0:!0};a.updateDraftMessage=function(a,f){if("object"===typeof f){var e={text:"",files:[]},c={fileMeta:f,filelb:ca.getFilePreviewPath(f),filesize:ca.getFilePreviewSize(f.size)};"undefined"!==typeof a&&"object"===typeof Ha[a]&&(e=Ha[a],b.each(e.files,function(a,b){b.filelb===c.filelb&&e.files.splice(a,1)}));e.files.push(c)}Ha[a]=e};a.updateUnreadCount=function(b,f,e){var c=a.getUnreadCount(b);wa[b]=f;if(e||0<Ea.length)H+=f-c,0>H&&(H=0),0<H?Ea.html(H):Ea.html("")};
a.incrementUnreadCount=function(a){H+=1;wa[a]="undefined"===typeof wa[a]?1:wa[a]+1;0<Ea.length&&Ea.html(H)};a.getUnreadCount=function(a){return"undefined"===typeof wa[a]?wa[a]=0:wa[a]};a.isGroupDeleted=function(a,b){if(b){var f=u.getDeletedAtTime(a);return"undefined"!==typeof f&&0<f}return!1};a.getTabDisplayName=function(b,f,e){var c="";if(f)return u.getGroupDisplayName(b);"function"===typeof Va&&(c=Va(b));"undefined"!==typeof e&&e&&(c=e,va[b]=e);c||(c=a.getContactDisplayName(b));f=a.fetchContact(""+
b);c?(f.displayName=c,ya[f.contactId]=f):"undefined"!==typeof f.displayName&&(c=f.displayName);c||(c=b);return c};a.populateMessage=function(a,f,c){var n=mckDateUtils.convertMilisIntoTime(f.metadata.CALL_DURATION);ba.loadUserProfile(f.to);103==f.contentType&&(4==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE?f.message="you rejected a Video call from "+f.to:5==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE?f.message=f.to+"rejected a Video call from you":4==f.type&&"CALL_END"==f.metadata.MSG_TYPE?f.message=
"you were in a call with "+f.to+"\n call duration : "+n:5==f.type&&"CALL_END"==f.metadata.MSG_TYPE?f.message="you were in a call with "+f.to+"\n call duration : "+n:4==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE?f.message="you missed a Video call from "+f.to:5==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE&&(f.message=f.to+"missed a Video call from you"));var d=A.data("mck-id"),v=e.isValidMetaData(f),n=f.groupId?mckGroupUtils.getGroup(f.groupId):e.getContact(f.to);if("undefined"===typeof d||""===d){var k=
b("#mck-contact-list").length;0<k&&v&&(f.groupId?e.addGroupFromMessage(f,!0):e.addContactsFromMessage(f,!0));if("APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){"undefined"===typeof n&&(n=f.groupId?mckGroupUtils.createGroup(f.groupId):e.createContact(f.to));if(bb){e.loadTab({tabId:n.contactId,isGroup:n.isGroup,conversationId:f.conversationId});return}a=f.groupId?"group_"+n.contactId:"user_"+n.contactId;v&&(10!==f.contentType&&102!==f.contentType&&e.incrementUnreadCount(a),Za.notifyUser(f));c=f.groupId?
"group-"+n.htmlId:"user-"+n.htmlId;b("#li-"+c+" .mck-unread-count-text").html(e.getUnreadCount(a));0<e.getUnreadCount(a)&&b("#li-"+c+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");w.sendDeliveryUpdate(f)}}else if("undefined"===typeof n&&(n=f.groupId?mckGroupUtils.createGroup(f.groupId):e.createContact(f.to)),"APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){if("undefined"!==typeof n&&(a=A.data("isgroup"),0===b("."+f.oldKey).length&&0===b("."+f.key).length||10===f.contentType)){if("undefined"===
typeof d||d!==n.contactId||a!==n.isGroup||X.hasClass("vis")){if(bb){e.loadTab({tabId:n.contactId,isGroup:n.isGroup,conversationId:f.conversationId});return}if(v&&10!==f.contentType||102!==f.contentType)a=f.groupId?"group_"+n.contactId:"user_"+n.contactId,e.incrementUnreadCount(a);w.sendDeliveryUpdate(f)}else{v=!0;a&&6===n.type&&(v=u.isAppendOpenGroupContextMenu(n));if(f.conversationId&&(qa||Ga))if((a=A.data("mck-conversationid"))&&a.toString()===f.conversationId.toString())f.metadata&&"HIDDEN"===
f.metadata.category||e.addMessage(f,n,!0,!0,v),w.sendReadUpdate(f.pairedMessageKey);else{if(bb){e.loadTab({tabId:n.contactId,isGroup:n.isGroup,conversationId:f.conversationId});return}}else 7===n.type&&(a=mckGroupUtils.getGroup(f.groupId),a=e.getContactFromGroupOfTwo(a),Q.lastSeenOfGroupOfTwo(a.contactId),e.addMessage(f,n,!0,!0,v)),(!f.metadata||"HIDDEN"!==f.metadata.category&&7!==n.type)&&e.addMessage(f,n,!0,!0,v),w.sendReadUpdate(f.pairedMessageKey);f.groupId||(b("#mck-tab-status").html(MCK_LABELS.online),
Q.updateUserStatus({userId:f.to,status:1}))}c&&6!==n.type&&Za.notifyUser(f)}}else"APPLOZIC_02"===a&&102==!f.contentType&&(0===b("."+f.oldKey).length&&0===b("."+f.key).length||10===f.contentType)&&(0<k?e.addContactsFromMessage(f,!0):"undefined"!==typeof n&&(a=A.data("isgroup"),"undefined"!==typeof d&&d===n.contactId&&a===n.isGroup&&(v=!0,a&&6===n.type&&(v=u.isAppendOpenGroupContextMenu(n)),f.metadata&&"HIDDEN"===f.metadata.category||e.addMessage(f,n,!0,!0,v),3===f.type&&(b("."+f.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
e.addTooltip(f.key)))));Cb.removeClass("vis").addClass("n-vis")};a.getMessageFeed=function(a){var f={};f.key=a.key;f.timeStamp=a.createdAtTime;f.message=a.message;f.from=4===a.type?a.to:y;f.to=a.groupId?a.groupId:5===a.type?a.to:y;f.status="read";f.type=4===a.type?"inbox":"outbox";5===a.type&&(3===a.status?f.status="sent":4===a.status&&(f.status="delivered"));if("object"===typeof a.fileMeta){var e=b.extend({},a.fileMeta);if("undefined"===typeof e.url||""===e.url)e.url=I+"/rest/ws/aws/file/"+a.fileMeta.blobKey;
delete e.blobKey;f.file=e}f.source=a.source;f.metadata=a.metadata;return f};a.updateUnreadCountonChatIcon=function(a){if(xb&&0<a.length){var f=null,c=0;0<a.length&&(b.each(a,function(a,b){!(0<b.unreadCount&&null!==f)&&0<b.unreadCount&&(f=b.userId,c=b.unreadCount)}),0<H&&"none"===p.css("display")&&(null!==f&&c===H?e.loadTab({tabId:f,isGroup:!1}):e.loadTab({tabId:"",isGroup:!1})))}};a.loadMessageListOnUserDetailFetch=function(a){Cb.removeClass("vis").addClass("n-vis");var f=A.data("mck-id"),c=A.data("isgroup");
if("undefined"===typeof f||a.tabId===f&&""+c===""+a.isGroup)f=mckGroupUtils.getGroup(a.tabId),u.addGroupStatus(f),c=6===f.type?!1:!0,c=!0,6===f.type&&(u.validateOpenGroupUser(f),c=u.isAppendOpenGroupContextMenu(f)),a.isMessages?(F.removeClass("vis").addClass("n-vis"),e.processMessageList(a.messageData,!0,c),6!==f.type&&Pa.removeClass("n-vis").addClass("vis"),"function"===typeof Oa&&Oa(a.tabId)):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(Pa.removeClass("vis").addClass("n-vis"),
F.removeClass("n-vis").addClass("vis"))}},w=new function(){var a=this,d=b("#mck-search"),l=b("#mck-msg-to"),C=b("#mck-msg-new"),c=b("#mck-sidebox"),E=b("#mck-file-box"),p=b("#mck-text-box"),D=b("#mck-msg-form"),q=b("#mck-msg-sbmt"),s=b("#mck-new-group"),x=b("#mck-tab-title"),V=b("#mck-msg-error"),xa=b("#mck-btn-attach"),zb=b("#mck-tab-status"),N=b("#mck-message-cell"),I=b(".mck-typing-box"),F=b("#mck-gms-loading"),k=b("#mck-group-title"),aa=b("#mck-contact-loading"),z=b("#mck-no-messages"),ra=b(".mck-group-search"),
Ia=b("#mck-msg-response"),L=b("#mck-msg-form input"),H=b("#mck-block-button"),W=b("#li-mck-block-user"),X=b("#li-mck-group-info"),Y=b("#li-mck-video-call"),ta=b("#mck_response_text"),ea=b(".mck-contact-search"),ka=b("#mck-group-info-tab"),T=b("#mck-price-text-box");b("#mck-sidebox-search");var ja=b("#mck-group-info-btn"),ka=b("#mck-group-info-tab"),P=b("#mck-btn-group-exit"),la=b("#mck-group-back-link"),na=b("#mck-btn-leave-group"),ca=b(".mck-sidebox-content"),ia=b("#mck-no-more-messages"),sa=b("#mck-btn-group-create");
b("#mck-group-create-tab");var va=b("#mck-group-add-member");b("#mck-contacts-content");var ma=b("#mck-tab-option-panel"),wa=b("#mck-no-conversations"),Fa=b("#mck-group-create-title"),ya=b(".mck-group-menu-options"),fa=b(".mck-tab-message-option"),Ba=b(".mck-group-admin-options"),pa=b("#mck-group-member-search"),r=b("#mck-message-cell .mck-message-inner");b("#mck-search-cell .mck-message-inner");var ua=b("#mck-no-more-conversations"),Ea=b("#mck-gm-search-box"),Ja=b("#mck-group-member-search-list"),
Ka=b("#mck-no-gsm-text");b.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');b(t).on("click",".mck-message-delete",function(){a.deleteMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(t).on("click",".mck-message-reply",function(){a.replyMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(t).on("click",
".mck-message-forward",function(){C.data("forwardMessageKey",b(this).parents(".mck-m-b").data("msgkey"));C.trigger("click")});b(".mck-minimize-icon").click(function(){b(".mck-box-md,.mck-box-ft").animate({height:"toggle"});ca.hasClass("minimized")?(ca.css("height","100%"),ca.removeClass("minimized")):(ca.css("height","0%"),ca.addClass("minimized"))});a.init=function(){B.clearMckMessageArray();b(t).on("click","."+Ra,function(){b(this).hasClass("mck-msg-preview")&&b(this).hide()});e.initSearchAutoType();
ea.click(function(){e.addContactsToContactSearchList()});ra.click(function(){e.addGroupsToGroupSearchList()});p.keydown(function(a){p.hasClass("mck-text-req")&&p.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||a.ctrlKey)){if(a.preventDefault(),g.getSelection){a=g.getSelection();var b=a.getRangeAt(0),e=t.createElement("br"),c=t.createTextNode("\u00a0");b.deleteContents();b.insertNode(e);b.collapse(!1);b.insertNode(c);b.selectNodeContents(c);a.removeAllRanges();a.addRange(b);p.animate({scrollTop:p.prop("scrollHeight")},
0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===ga&&U.sendTypingStatus(0,r.data("mck-id")),q.is(":disabled")&&E.hasClass("vis")?alert("Please wait file is uploading."):D.submit()):0===ga&&U.sendTypingStatus(1,r.data("mck-id"))});b(t).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&w.deleteConversation()});b(t).on("click",".applozic-tm-launcher",function(a){a.preventDefault();var c=b(this).data("mck-id"),c="undefined"!==typeof c&&""!==c?c.toString():
"",d=b(this).data("mck-name"),d="undefined"!==typeof d&&""!==d?d.toString():"";a=b(this).data("mck-supportid");a="undefined"!==typeof a&&""!==a?a.toString():"";var k=b(this).data("mck-topicid"),k="undefined"!==typeof k&&""!==k?k.toString():"",h=b(this).data("mck-msg"),h="undefined"!==typeof h&&""!==h?h.toString():"";if("function"===typeof Ca&&k){var g=Ca(k);"object"===typeof g&&"undefined"!==g.title&&(K[k]=g)}c={topicId:k,tabId:c,userName:d,isMessage:!0};c.messagePxy={type:5,contentType:0,message:h};
a?(c.isGroup=!0,c.supportId=a,w.getConversationId(c)):(c.isGroup=!1,e.loadTab(c,w.dispatchMessage))});b(t).on("click",".applozic-wt-launcher",function(a){a.preventDefault();a=b(this).data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var e=b(this).data("mck-name"),e="undefined"!==typeof e&&""!==e?e.toString():"",c=b(this).data("mck-topicid"),c="undefined"!==typeof c&&""!==c?c.toString():"",d=b(this).data("mck-topic-status"),d=d?-1===M.indexOf(d)?M[0]:d.toString():M[0];if("function"===
typeof Ca){var k=Ca(c);"object"===typeof k&&"undefined"!==k.title&&(K[c]=k)}w.getConversationId({tabId:a,isGroup:!1,userName:e,topicId:c,topicStatus:d,isMessage:!1})});b(t).on("click",".applozic-ct-launcher",function(a){a.preventDefault();var e=b(this).data("mck-id"),e="undefined"!==typeof e&&""!==e?e.toString():"",c=b(this).data("mck-name"),c="undefined"!==typeof c&&""!==c?c.toString():"";a=b(this).data("mck-topicid");a="undefined"!==typeof a&&""!==a?a.toString():"";var d=b(this).data("mck-topic-status"),
d=d?-1===M.indexOf(d)?M[0]:d.toString():M[0],e={tabId:e,isGroup:!1,userName:c,topicId:a,topicStatus:d,isMessage:!1};"function"===typeof ub&&(c=ub(a),"object"===typeof c&&(c.topicDetail&&"object"===typeof c.topicDetail&&"undefined"!==c.topicDetail.title&&(K[a]=c.topicDetail),c.fallBackTemplatesList&&0<c.fallBackTemplatesList.length&&(e.fallBackTemplatesList=c.fallBackTemplatesList)));w.getConversationId(e)});b(t).on("click","."+Ra+", .mck-contact-list ."+Ra,function(f){f.preventDefault();var c=this;
b(this).parents(".mck-search-list").length?(d.bind("blur"),setTimeout(function(){a.openChat(c)},600)):a.openChat(this)});b(t).on("click",".mck-conversation-tab-link",function(a){a.preventDefault();b(this);a=r.data("mck-id");var c=r.data("isgroup");e.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:c})});b(t).on("click",".mck-close-sidebox",function(a){a.preventDefault();c.mckModal("hide");a=r.data("mck-conversationid");r.data("mck-id","");r.data("mck-topicid","");r.data("mck-name",
"");r.data("mck-conversationid","");a&&(a=O[a],"object"===typeof a&&(a=a.topicId,"function"===typeof nb&&nb(y,a)));U.unsubscibeToTypingChannel()});b(t).on("click",".mck-price-submit",function(b){b.preventDefault();a.sendPriceMessage()});T.keydown(function(b){13===b.keyCode&&a.sendPriceMessage()});r.bind("scroll",function(){if(0<r.find(".mck-contact-list").length){if(r.scrollTop()+r.innerHeight()>=r[0].scrollHeight){var a=r.data("datetime");0<a&&!za&&w.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===
r.scrollTop()){var b=r.data("mck-id");if("undefined"!==typeof b&&""!==b){var c=r.data("isgroup"),e=r.data("mck-conversationid"),e=e?e.toString():"",a=ma.data("datetime");0<a&&!za&&w.loadMessageList({tabId:b,isGroup:c,conversationId:e,startTime:a})}}});T.on("click",function(a){a.preventDefault();T.removeClass("mck-text-req")});H.on("click",function(a){a.preventDefault();a=r.data("mck-id");var b=r.data("isgroup"),c=!r.data("blocked");b?(W.removeClass("vis").addClass("n-vis"),Y.removeClass("vis").addClass("n-vis")):
confirm(c?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&ba.blockUser(a,c)});na.on("click",function(a){a.preventDefault();a=r.data("mck-id");r.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:u.onGroupLeft,groupId:a}):ya.removeClass("vis").addClass("n-vis")});b(t).on("click",".mck-add-to-group",function(a){a.preventDefault();a=b(this).data("mck-id");"undefined"!==typeof a&&u.addGroupMemberFromSearch(a);Ea.mckModal("hide")});b(t).on("click",
".mck-btn-remove-member",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").data("mck-id");var c=ka.data("mck-id");if("undefined"!==typeof c&&"undefined"!==typeof a){var e=mckGroupUtils.getGroup(c);"object"===typeof e&&y===e.adminName?confirm(MCK_LABELS["remove.member.alert"])&&mckGroupService.removeGroupMember({groupId:c,userId:a,apzCallback:u.onRemovedGroupMember}):Ba.removeClass("vis").addClass("n-vis")}});P.on("click",function(a){a.preventDefault();(a=ka.data("mck-id"))?
confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:a,apzCallback:u.onGroupLeft}):e.loadTab({tabId:"",isGroup:!1})});ja.on("click",function(a){a.preventDefault();a=r.data("mck-id");if(r.data("isgroup")){a={groupId:a};var b=r.data("mck-conversationid");b&&(a.conversationId=b);u.loadGroupInfo(a)}else ya.removeClass("vis").addClass("n-vis")});s.on("click",function(a){a.preventDefault();u.loadCreateGroupTab()});la.on("click",function(a){a.preventDefault();var b=ka.data("mck-id");
a=ka.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=a),e.loadTab(b)):e.loadTab({tabId:"",isGroup:!1})});va.on("click",function(a){a.preventDefault();if(a=ka.data("mck-id"))(a=mckGroupUtils.getGroup(a))&&a.adminName===y?(Ja.html(""),Ea.mckModal(),F.removeClass("n-vis").addClass("vis"),0<Ma.length?u.addMembersToGroupSearchList():wb?0<La.length?(b.each(La,function(a,b){Ma.push(b.contactId)}),u.addMembersToGroupSearchList()):(F.removeClass("vis").addClass("n-vis"),Ka.removeClass("n-vis").addClass("vis")):
ba.getUserStatus({callback:u.addMembersToGroupSearchList})):Ba.removeClass("vis").addClass("n-vis")});pa.keypress(function(a){if(13===a.which)return a=pa.val(),""!==a&&u.addGroupMemberFromSearch(a),pa.val(""),!0});b(t).on("click",".mck-group-member-search-link",function(a){a.preventDefault();a=pa.val();""!==a&&u.addGroupMemberFromSearch(a);pa.val("")});b(t).on("click",".mck-show-more",function(a){a.preventDefault();var c=b(this);a=c.data("tabId");var e=r.data("isgroup"),d=r.data("mck-conversationid"),
d=d?d.toString():"",c=c.data("datetime");w.loadMessageList({tabId:a,isGroup:e,conversationId:d,startTime:c})});b(t).on("click",".mck-accept",function(a){a=b(this).data("mck-conversationid");var c=b(this).data("mck-topic-price");if("function"===typeof Da&&c&&a){var e=O[a],d=l.val(),d=u.getGroupDisplayName(d);"object"===typeof e?(Da({custId:y,suppId:d,productId:e.topicId,price:c}),w.sendConversationCloseUpdate(a)):w.getTopicId({conversationId:a,suppId:d,priceText:c})}});D.submit(function(){1===ga&&
U.sendTypingStatus(0,r.data("mck-id"));var f=b.trim(mckUtils.textVal(p[0]));E.hasClass("n-vis")&&0<J.length&&(J=[]);if(0===f.length&&0===J.length)return p.addClass("mck-text-req"),!1;if("function"===typeof sb&&!sb(f))return!1;var f={type:5,contentType:0,message:f},c=r.data("mck-conversationid"),e=r.data("mck-topicid");c?f.conversationId=c:e&&(c={topicId:e},e=K[e],"object"===typeof e&&(c.topicDetail=g.JSON.stringify(e)),f.conversationPxy=c);!0===r.data("isgroup")?f.groupId=l.val():f.to=l.val();q.attr("disabled",
!0);V.removeClass("vis").addClass("n-vis");V.html("");ta.html("");Ia.removeClass("vis").addClass("n-vis");a.sendMessage(f);return!1});L.on("click",function(){b(this).val("");V.removeClass("vis").addClass("n-vis");Ia.removeClass("vis").addClass("n-vis")});b(t).bind("click",function(a){b(".mck-context-menu").removeClass("vis").addClass("n-vis");!xa.hasClass("on")||b(a.target).hasClass("mck-icon-upload")||b(a.target).hasClass("mck-btn-attach")||yb.fileMenuToggle();p.removeClass("mck-text-req");t.activeElement&&
t.activeElement!==p&&1===ga&&U.sendTypingStatus(0,r.data("mck-id"));t.activeElement&&"mck-group-name-save"!==t.activeElement.id&&k.removeClass("mck-req-border");t.activeElement&&"mck-btn-group-create"!==t.activeElement.id&&Fa.removeClass("mck-req-border");b(".mcktypeahead.mck-dropdown-menu").hide()});b(".mck-tabview-item").click(function(){b(".mck-tabview-item").removeClass("active");b(this).addClass("active")})};a.openChat=function(a){var c=b(a);a=c.data("mck-id");a="undefined"!==typeof a&&""!==
a?a.toString():"";var k=c.data("mck-name"),k="undefined"!==typeof k&&""!==k?k.toString():"",g=c.data("mck-topicid"),g="undefined"!==typeof g&&""!==g?g.toString():"",l=!0===c.data("isgroup"),c=c.data("mck-conversationid"),c="undefined"!==typeof c&&""!==c?c.toString():"";g&&!c?(c=(c=b(elem).data("mck-topic-status"))?-1===M.indexOf(c)?M[0]:c.toString():M[0],w.getConversationId({tabId:a,isGroup:l,userName:k,topicId:g,topicStatus:c,isMessage:!1})):e.loadTab({tabId:a,isGroup:l,userName:k,conversationId:c,
topicId:g});d.val("")};a.sendMessage=function(f){if("object"===typeof f){var c=f.metadata?f.metadata:{},d=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof d||""===d||f.forward||(c.AL_REPLY=d);f.metadata=c;if("undefined"!==typeof f.message&&0!==f.message.length||0!==J.length){if(f.conversationId&&(c=O[f.conversationId],"undefined"!==c&&c.closed)){e.closeConversation();q.attr("disabled",!1);return}if(r.data("blocked"))Q.toggleBlockUser(h,!0),q.attr("disabled",!1);else{var k="";f.groupId?(k=
mckGroupUtils.getGroup(f.groupId),"undefined"===typeof k&&(k=mckGroupUtils.createGroup(f.groupId))):k=f.clientGroupId?mckGroupUtils.getGroupByClientGroupId(f.clientGroupId):e.fetchContact(f.to);0<b("#mck-message-cell .mck-no-data-text").length&&b(".mck-no-data-text").remove();if(f.message&&0===J.length){var c=fa.hasClass("n-vis"),h=r.data("mck-id"),g=mckUtils.randomId();f.key=g;12!==f.contentType&&h&&h.toString()===k.contactId&&102!==f.contentType&&a.addMessageToTab(f,k);a.submitMessage(f,{tabId:k.contactId,
isTopPanelAdded:c})}else 0<J.length&&b.each(J,function(b,c){var e=fa.hasClass("n-vis"),d=r.data("mck-id"),n=mckUtils.randomId();f.key=n;f.fileMeta=c;f.contentType=1;12!==f.contentType&&d&&d.toString()===k.contactId&&a.addMessageToTab(f,k);a.submitMessage(f,{tabId:k.contactId,isTopPanelAdded:e})});p.removeClass("mck-text-req");q.attr("disabled",!1);b("."+g+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");e.addTooltip(g);e.clearMessageField(!0);J=[];delete Ha[k.contactId]}}else p.addClass("mck-text-req")}};
a.addMessageToTab=function(a,b){var c={to:a.to,groupId:a.groupId,deviceKey:a.deviceKey,contentType:a.contentType,message:a.message,conversationId:a.conversationId,topicId:a.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:a.key,storeOnDevice:!0,sent:!1,read:!0,metadata:a.metadata?a.metadata:""};c.type=a.type?a.type:5;a.fileMeta&&(c.fileMeta=a.fileMeta);e.addMessage(c,b,!0,!0,!1)};a.sendForwardMessage=function(b){var c=B.getMessageByKey(b);if("undefined"!==typeof c){c.fileMeta&&J.push(c.fileMeta);
b={type:5,contentType:c.contentType,message:c.message,forward:"forward"};c.metadata&&(c.metadata.AL_REPLY&&(c.metadata.AL_REPLY=""),b.metadata=c.metadata);var e=r.data("mck-conversationid"),c=r.data("mck-topicid");e?b.conversationId=e:c&&(e={topicId:c},c=K[c],"object"===typeof c&&(e.topicDetail=g.JSON.stringify(c)),b.conversationPxy=e);!0===r.data("isgroup")?b.groupId=l.val():b.to=l.val();a.sendMessage(b)}};a.sendWelcomeMessage=function(b){var c=mckUtils.randomId(),d=r.data("mck-id"),k=r.data("isgroup"),
c={key:c,type:4,contentType:0,to:b.sender,message:b.messageContent};d&&d.toString()===b.sender&&!k&&(d=e.fetchContact(d),a.addMessageToTab(c,d));mckUtils.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(b.sender)+"\x26messageContent\x3d"+encodeURIComponent(b.messageContent),contentType:"text/plain",success:function(a){b.callback&&b.callback(a)}})};a.submitMessage=function(a,c){var d=a.key,k=a.metadata?a.metadata:{};Mb&&(a.metadata={userStatus:4});
var h=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof h||""===h||a.forward||(k.AL_REPLY=h,b("#mck-text-box").data("AL_REPLY",""));a.source=$b;var l=b("#mck-message-cell .mck-message-inner div[name\x3d'message']."+d);102!=a.contentType&&103!=a.contentType&&(a.metadata=Lb);a.metadata=k;mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:g.JSON.stringify(a),contentType:"application/json",success:function(k){var h=r.data("mck-id");if("object"===typeof k){var g=
k.messageKey;if(h&&h.toString()===c.tabId){var z=k.conversationId;r.data("mck-conversationid",z);l.removeClass(d).addClass(g);l.data("msgkey",g);b("."+g+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");e.addTooltip(g);c.isTopPanelAdded&&ma.data("datetime",k.createdAt);k=!0;a.groupId&&6===mckGroupUtils.getGroup(a.groupId).type&&(k=!1);k&&e.messageContextMenu(g)}a.conversationPxy&&(g=a.conversationPxy,a.topicId&&(oa[a.topicId]=[z]),O[z]=g)}else"CONVERSATION_CLOSED"===
k||"BUSY_WITH_OTHER"===k?(q.attr("disabled",!1),e.closeConversation(k),l.remove(),c.isTopPanelAdded&&fa.removeClass("vis").addClass("n-vis")):"error"===k&&(q.attr("disabled",!1),V.html("Unable to process your request. Please try again"),V.removeClass("n-vis").addClass("vis"),l.remove(),c.isTopPanelAdded&&fa.removeClass("vis").addClass("n-vis"))},error:function(){V.html("Unable to process your request. Please try again.");V.removeClass("n-vis").addClass("vis");l&&l.remove();c.isTopPanelAdded&&fa.removeClass("vis").addClass("n-vis")}});
$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};a.downloadImage=function(a){window.open(a,"_blank")};a.replyMessage=function(a){var b="";r.data("mck-id");var c=w.getReplyMessageByKey(a);p.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");b=5===c.type?"You":e.getTabDisplayName(c.to,!1);$("#mck-reply-to").html(b);"object"===typeof c.fileMeta||2===c.contentType?$("#mck-reply-msg").html(e.getImageForMessagePreview(c)):$("#mck-reply-msg").html(c.message);$("#mck-text-box").data("AL_REPLY",
a)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");$("#mck-text-box").data("AL_REPLY","")});a.deleteMessage=function(a){var c=r.data("mck-id");"undefined"!==typeof c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+a,type:"get",success:function(e){"success"===e?(r.data("mck-id")===c&&(b("."+a).remove(),r.is(":empty")&&fa.removeClass("vis").addClass("n-vis")),B.clearMckMessageArray()):g.console.log("Unable to delete message. Please reload page.")}})};
a.deleteConversation=function(){var a=r.data("mck-id"),b=r.data("isgroup"),c=r.data("mck-conversationid");"undefined"!==typeof a&&(b=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),c&&(b+="\x26conversationId\x3d"+c),za=!0,mckUtils.ajax({type:"get",url:MCK_BASE_URL+"/rest/ws/message/delete/conversation",global:!1,data:b,success:function(){r.data("mck-id")===a&&(r.html(""),ma.data("datetime",""),N.removeClass("n-vis").addClass("vis"),z.removeClass("n-vis").addClass("vis"),fa.removeClass("vis").addClass("n-vis"),
za=!1)},error:function(){}}))};a.getMessages=function(a){var b="";"undefined"!==typeof a.userId&&""!==a.userId?(b=a.isGroup?"\x26groupId\x3d"+a.userId:"\x26userId\x3d"+encodeURIComponent(a.userId),a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26pageSize\x3d30",(qa||Ga)&&a.conversationId&&(b+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof Z[a.userId]&&(b+="\x26conversationReq\x3dtrue"))):(a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26mainPageSize\x3d100");var c={};
mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+b,type:"get",success:function(b){c.status="success";c.data=b;a.callback&&a.callback(c)},error:function(b,e,d){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));c.status="error";a.callback&&a.callback(c)}})};a.getMessageList=function(a){var c=a.id;if("undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){var d=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",d=d+("\x26clientGroupId\x3d"+
a.clientGroupId);a.startTime&&(d+="\x26endTime\x3d"+a.startTime);var k={clientGroupId:a.clientGroupId}}else"undefined"!==typeof c&&""!==c?(d=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",d+="true"===""+a.isGroup?"\x26groupId\x3d"+c:"\x26userId\x3d"+c,a.startTime&&(d+="\x26endTime\x3d"+a.startTime),k={id:c}):(d=a.pageSize?"\x26mainPageSize\x3d"+a.pageSize:"\x26mainPageSize\x3d50",a.startTime&&(d+="\x26endTime\x3d"+a.startTime),k={id:""});a.topicId&&(c||a.clientGroupId)&&(a.conversationId&&
(d+="\x26conversationId\x3d"+a.conversationId),a.topicId&&(k.topicId=a.topicId));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+d,type:"get",global:!1,success:function(c){k.status="success";if("undefined"===typeof c.message||0===c.message.length)k.messages=[];else{var d=[];b.each(c.message,function(a,b){if("undefined"!==typeof b.to||"undefined"!==typeof b.groupId){var f=e.getMessageFeed(b);d.push(f)}});k.messages=d}0<c.groupFeeds.length&&(k.id=c.groupFeeds[0].id);a.callback(k)},
error:function(b,c,e){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));k.status="error";a.callback(k)}})};a.getReplyMessageByKey=function(a){"undefined"===typeof B.getMessageByKey(a)&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/detail",async:!1,type:"get",data:"keys\x3d"+a,success:function(a){B.updateMckMessageArray(a)}});return B.getMessageByKey(a)};a.loadMessageList=function(a,c){var d=!1,k=!1,h="";"undefined"!==typeof a.tabId&&""!==a.tabId?(h=a.isGroup?"\x26groupId\x3d"+
a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId),d=!0,a.startTime&&(h+="\x26endTime\x3d"+a.startTime),h+="\x26pageSize\x3d30",(qa||Ga)&&a.conversationId&&(h+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof Z[a.tabId]?(k=!0,h+="\x26conversationReq\x3dtrue"):e.addConversationMenu(a.tabId,a.isGroup))):(za=!0,a.startTime&&(h+="\x26endTime\x3d"+a.startTime),h+="\x26mainPageSize\x3d60");a.startTime||r.html("");aa.removeClass("n-vis").addClass("vis");mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+
h,type:"get",global:!1,success:function(h){var l=!0,p=r.data("mck-id"),s=r.data("isgroup");a.isGroup&&!a.startTime||aa.removeClass("vis").addClass("n-vis");za=!1;if("undefined"===typeof p||a.tabId===p&&""+s===""+a.isGroup){if("null"===h+""||"undefined"===typeof h.message||0===h.message.length)l=!1,d?a.startTime?(ia.removeClass("n-vis").addClass("vis"),ia.fadeOut(5E3,function(){ia.removeClass("vis").addClass("n-vis")}),ma.data("datetime","")):a.isGroup||0!==b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||
(fa.removeClass("vis").addClass("n-vis"),wa.removeClass("vis").addClass("n-vis"),z.removeClass("n-vis").addClass("vis")):(z.removeClass("vis").addClass("n-vis"),a.startTime?(ua.removeClass("n-vis").addClass("vis"),ua.fadeOut(5E3,function(){ua.removeClass("vis").addClass("n-vis")})):(z.removeClass("vis").addClass("n-vis"),wa.removeClass("n-vis").addClass("vis")),r.data("datetime",""));if("null"!==h+""&&"error"!==h.status)if(d){l&&(0<a.startTime?e.processMessageList(h,!1,!0):a.isGroup||(e.processMessageList(h,
!0,!0),fa.removeClass("n-vis").addClass("vis")));0<!a.startTime&&!a.isGroup&&"function"===typeof Oa&&Oa(a.tabId);0<h.userDetails.length&&b.each(h.userDetails,function(b,c){da[c.userId]=c;if(!a.isGroup&&(c.connected?g.MCK_OL_MAP[c.userId]=!0:(g.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(S[c.userId]=c.lastSeenAtTime)),Ua||a.isGroup||(c.blockedByThis?(ha[c.userId]=!0,Q.toggleBlockUser(a.tabId,!0)):c.blockedByOther?(Aa[c.userId]=!0,x.removeClass("mck-tab-title-w-status"),zb.removeClass("vis").addClass("n-vis"),
I.removeClass("vis").addClass("n-vis"),r.data("blocked",!1)):Q.toggleBlockUser(a.tabId,!1)),c.userName&&!a.startTime)){var d=e.getTabDisplayName(a.tabId,a.isGroup,c.userName);x.html(d);x.attr("title",d)}});!Xa||a.isGroup||a.startTime||g.MCK_OL_MAP[a.tabId]||Sa.manageOfflineMessageTime(a.tabId);if(0<h.conversationPxys.length){var E=[];b.each(h.conversationPxys,function(a,c){if("object"===typeof c&&(E.push(c),O[c.id]=c,oa[c.topicId]=[c.id],c.topicDetail))try{K[c.topicId]=b.parseJSON(c.topicDetail)}catch(f){g.console.log("Incorect Topic Detail!")}});
k&&(Z[a.tabId]=E,e.addConversationMenu(a.tabId,a.isGroup))}a.conversationId&&(p=O[a.conversationId],"object"===typeof p&&p.closed&&e.closeConversation());a.startTime||(a.isGroup?(u.addGroupStatus(mckGroupUtils.getGroup(a.tabId)),e.updateUnreadCount("group_"+a.tabId,0,!0)):e.updateUnreadCount("user_"+a.tabId,0,!0),"function"===typeof c&&c(a));0<h.groupFeeds.length&&b.each(h.groupFeeds,function(c,d){var k=mckGroupUtils.addGroup(d);if(!a.startTime){var g=[];b.each(d.membersId,function(a,b){"undefined"===
typeof e.getContact(b)&&g.push(b)});if(0<g.length)a.isMessages=l,a.messageData=h,a.isLoadMessageList=!0,ba.getUsersDetail(g,a);else{u.addGroupStatus(k);var n=!0;if(7===k.type){X.removeClass("vis").addClass("n-vis");var v=e.getContactFromGroupOfTwo(k);Q.lastSeenOfGroupOfTwo(v.contactId)}6===k.type&&(u.validateOpenGroupUser(k),n=u.isAppendOpenGroupContextMenu(k));aa.removeClass("vis").addClass("n-vis");l?(z.removeClass("vis").addClass("n-vis"),e.processMessageList(h,!0,n),6!==k.type&&fa.removeClass("n-vis").addClass("vis")):
0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(fa.removeClass("vis").addClass("n-vis"),z.removeClass("n-vis").addClass("vis"));"function"===typeof Oa&&Oa(a.tabId)}}})}else a.startTime||(g.MCK_OL_MAP=[]),0<h.userDetails.length&&b.each(h.userDetails,function(a,b){da[b.userId]=b;b.connected?g.MCK_OL_MAP[b.userId]=!0:(g.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(S[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var c=
e.getContact(""+b.userId);"undefined"===typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b)}),0<h.groupFeeds.length&&b.each(h.groupFeeds,function(a,b){e.updateUnreadCount("group_"+b.id,b.unreadCount,!1);mckGroupUtils.addGroup(b)}),0<h.blockedUserPxyList.blockedToUserList.length&&b.each(h.blockedUserPxyList.blockedToUserList,function(a,b){b.userBlocked&&(ha[b.blockedTo]=!0)}),0<h.blockedUserPxyList.blockedByUserList.length&&b.each(h.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&
(Aa[b.blockedBy]=!0)}),0<h.conversationPxys.length&&b.each(h.conversationPxys,function(a,c){O[c.id]=c;oa[c.topicId]=[c.id];if(c.topicDetail)try{K[c.topicId]=b.parseJSON(c.topicDetail)}catch(f){g.console.log("Incorect Topic Detail!")}}),l?(a.startTime?a.startTime&&(a.isReload=!1,d||B.updateLatestMessageArray(h.message)):(a.isReload=!0,d||B.setLatestMessageArray(h.message)),d&&B.updateMckMessageArray(h.message),e.addContactsFromMessageList(h,a)):r.data("datetime",""),a.isLaunch&&e.updateUnreadCountonChatIcon(h.userDetails)}p=
C.data("forwardMessageKey");"undefined"!==typeof p&&(w.sendForwardMessage(p),C.data("forwardMessageKey",""))},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));za=!1;aa.removeClass("vis").addClass("n-vis");g.console.log("Unable to load messages. Please reload page.")}})};a.updateContactList=function(a,b){var c="startIndex\x3d0\x26pageSize\x3d1\x26"+(b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list",
data:c,global:!1,type:"get",success:function(c){"null"===c+""||"undefined"===typeof c.message||0===c.message.length?e.clearContactMessageData(a,b):(c=c.message[0],"undefined"!==typeof c&&(c.groupId?e.addGroupFromMessage(c,!0):e.addContactsFromMessage(c,!0)))},error:function(c,d,k){401===c.status&&(sessionStorage.clear(),console.log("Please reload page."));e.clearContactMessageData(a,b)}})};a.sendDeliveryUpdate=function(a){mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delivered",data:"key\x3d"+
a.pairedMessageKey,global:!1,type:"get",success:function(){},error:function(){}})};a.sendReadUpdate=function(a){"undefined"!==typeof a&&""!==a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read",data:"key\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};a.conversationReadUpdate=function(a,b){var c=b?"group_"+a:"user_"+a;if(a&&0<e.getUnreadCount(c)){var d=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read/conversation",
data:d,global:!1,type:"get",success:function(){e.updateUnreadCount(c,0,!0)},error:function(){}})}};a.getConversationId=function(c){if(!c.isGroup&&!c.isMessage&&c.topicStatus!==M[1]){var d=oa[c.topicId];if(d&&(d=O[d],"object"===typeof d)){r.data("mck-conversationid",d.id);c.conversationId=d.id;if("undefined"!==typeof Z[c.tabId]){var k=Z[c.tabId];k.push(d);Z[c.tabId]=k}e.loadTab(c);return}}c.topicId&&(d={topicId:c.topicId,userId:c.tabId,status:c.topicStatus},c.isGroup&&(d.supportIds=[],d.supportIds.push(c.supportId)),
k=K[c.topicId],"object"===typeof k&&(d.topicDetail=g.JSON.stringify(k)),c.fallBackTemplatesList&&0<c.fallBackTemplatesList.length&&(d.fallBackTemplatesList=c.fallBackTemplatesList),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/id",global:!1,data:g.JSON.stringify(d),type:"post",contentType:"application/json",success:function(d){if("object"===typeof d&&"success"===d.status){var k=d.response;if("object"===typeof k&&"undefined"!==k.conversationPxy){d=k.conversationPxy;O[d.id]=d;oa[d.topicId]=
[d.id];if(d.topicDetail)try{K[d.topicId]=b.parseJSON(d.topicDetail)}catch(h){g.console.log("Incorect Topic Detail!")}r.data("mck-conversationid",d.id);c.conversationId=d.id;if("undefined"!==typeof Z[c.tabId]){var l=Z[c.tabId];l.push(d);Z[c.tabId]=l}c.isGroup&&(k=mckGroupUtils.addGroup(k),c.tabId=k.contactId);c.isMessage&&d.created?e.loadTab(c,a.dispatchMessage):e.loadTab(c)}}},error:function(){}}))};a.fetchConversationByTopicId=function(a){var c="topic\x3d"+a.topicId;if(a.tabId)c+="true"===""+a.isGroup?
"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId);else if(a.clientGroupId)c+="\x26clientGroupId\x3d"+a.clientGroupId;else return!1;a.pageSize&&(c+="\x26pageSize\x3d"+a.pageSize);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/get",data:c,type:"get",success:function(c){"object"===typeof c&&"success"===c.status?(c=c.response,0<c.length&&b.each(c,function(c,e){O[e.id]=e;oa[e.topicId]=[e.id];if(e.topicDetail)try{K[e.topicId]=b.parseJSON(e.topicDetail)}catch(d){g.console.log("Incorect Topic Detail!")}if(a.tabId&&
"undefined"!==typeof Z[a.tabId]){var k=Z[a.tabId];k.push(e);Z[a.tabId]=k}}),a.isExtMessageList&&(0<c.length?(a.conversationId=c[0].id,a.pageSize=50,w.getMessageList(a)):"function"===typeof a.callback&&(c={},a.tabId?(c.id=a.tabId,c.isGroup=a.isGroup):a.clientGroupId&&(c.clientGroupId=a.clientGroupId),c.topicId=a.topicId,c.status="success",c.messages=[],a.callback(c)))):a.isExtMessageList&&"function"===typeof a.callback&&(c={},a.tabId?c.id=a.tabId:a.clientGroupId&&(c.clientGroupId=a.clientGroupId),
c.topicId=a.topicId,c.status="error",c.errorMessage="Unable to process request. Please try again.",a.callback(c))},error:function(){if("function"===typeof a.callback){var b={};a.tabId?b.id=a.tabId:a.clientGroupId&&(b.clientGroupId=a.clientGroupId);b.topicId=a.topicId;b.status="error";b.errorMessage="Unable to process request. Please try again.";a.callback(b)}}})};a.getTopicId=function(c){c.conversationId&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/topicId",data:"id\x3d"+c.conversationId,
global:!1,type:"get",async:"undefined"!==typeof c.async?c.async:!0,success:function(d){if("object"===typeof d&&"success"===d.status&&(d=d.response,"object"===typeof d)){oa[d.topicId]=[c.conversationId];O[c.conversationId]=d;if(d.topicDetail)try{K[d.topicId]=b.parseJSON(d.topicDetail)}catch(k){g.console.log("Incorect Topic Detail!")}"function"===typeof Da&&c.priceText&&(Da({custId:y,suppId:c.suppId,productId:d.topicId,price:c.priceText}),a.sendConversationCloseUpdate(c.conversationId));if(c.messageType&&
"object"===typeof c.message){var h=c.message.groupId?c.message.groupId:c.message.to;if("undefined"!==typeof Z[h]){var l=Z[h];l.push(d);Z[h]=l}("undefined"!==typeof c.populate?c.populate:1)&&e.populateMessage(c.messageType,c.message,c.notifyUser)}"function"===typeof c.callback&&c.callback(d)}},error:function(){}})};a.sendConversationCloseUpdate=function(a){a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/close",data:"id\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};
a.sendPriceMessage=function(){var c=T.val();if(""===c)T.addClass("mck-text-req");else{var c=b.trim(c),e=l.val(),d=r.data("mck-conversationid",d),k={type:5,contentType:4,message:c};!0===r.data("isgroup")?k.groupId=e:k.to=e;if(r.data("mck-conversationid")){d=r.data("mck-conversationid");k.conversationId=d;var h=O[d];"object"!==h?a.getTopicId({conversationId:d,suppId:e,priceText:c}):"function"===typeof Da&&Da({custId:y,suppId:e,productId:h.topicId,price:c});T.val("")}a.sendMessage(k)}};a.dispatchMessage=
function(c){if("object"===c.messagePxy){var e=c.messagePxy;if(c.topicId){var d=K[c.topicId];if("object"===typeof d&&"undefined"!==d.title)if(e.message||(e.message=b.trim(d.title)),c.conversationId)e.conversationId=c.conversationId;else if(c.topicId){var k={topicId:c.topicId};"object"===typeof d&&(k.topicDetail=g.JSON.stringify(d));e.conversationPxy=k}!e.message&&d.link&&(d={blobKey:b.trim(d.link),contentType:"image/png"},e.fileMeta=d,e.contentType=5,J=[],J.push(d))}c.isGroup?e.groupId=c.tabId:e.to=
c.tabId;a.sendMessage(e)}};a.getGroup=function(c){var d=[];b.each(c.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&-1===jb.indexOf(b.groupRole)||d.push(b))});var k={groupName:b.trim(c.groupName),users:d,type:c.type};c.clientGroupId&&(k.clientGroupId=c.clientGroupId);c.groupIcon&&(k.imageUrl=c.groupIcon);k.metadata=MCK_LABELS["group.metadata"];var h={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/group/create",global:!1,data:g.JSON.stringify(k),type:"post",contentType:"application/json",
success:function(d){c.isInternal&&sa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof d&&"success"===d.status){if(d=d.response,"object"===typeof d){var k=mckGroupUtils.addGroup(d);0<d.users.length&&b.each(d.users,function(a,b){da[b.userId]=b;b.connected?g.MCK_OL_MAP[b.userId]=!0:(g.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(S[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var c=e.getContact(""+b.userId);"undefined"===
typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b)});c.tabId=k.contactId;c.isGroup=!0;c.isMessage?e.loadTab(c,a.dispatchMessage):c.isInternal?(r.data("mck-id",k.contactId),r.data("isgroup",!0),u.loadGroupInfo({groupId:k.contactId})):e.loadTab(c);"function"===typeof c.callback&&(h.status="success",h.data=k,c.callback(h))}}else"error"===d.status&&"function"===typeof c.callback&&(h.status="error",h.errorMessage=d.errorResponse[0].description,c.callback(h))},error:function(){c.isInternal&&
sa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof c.callback&&(h.status="error",h.errorMessage="Unable to process request.",c.callback(h))}})};a.sendVideoCallMessage=function(b,c,e,d){var k="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"";if(""==k||void 0==k)k="video message";b={to:l.val(),type:5,contentType:e,message:k,metadata:{MSG_TYPE:c,CALL_ID:b,CALL_AUDIO_ONLY:d},senderName:y};a.sendMessage(b);return b};a.sendVideoCallEndMessage=function(b,
c,e,d,k){var h="";k&&(h=mckDateUtils.convertMilisIntoTime(k));h="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"CALL_END"==c?"Call End \n Duration: "+h:"video message";if(""==h||void 0==h)h="video message";b={to:l.val(),type:5,contentType:e,message:h,metadata:{MSG_TYPE:c,CALL_ID:b,CALL_AUDIO_ONLY:d,CALL_DURATION:k}};a.sendMessage(b);return b}},ba=new function(){var a=this;b("#mck-search-list");var d=b("#mck-sidebox-search"),l=b("#mck-search-loading");b("#mck-search-cell .mck-message-inner");
b("#mck-message-cell .mck-message-inner");b(".mck-tab-message-option");b("#mck-contact-loading");a.getContactDisplayName=function(a){var b=[];if(0<a.length&&a[0]){for(var d="",h=a.filter(function(b,c){return a.indexOf(b)===c}),g=0;g<h.length;g++){var l=h[g];"undefined"===typeof va[l]&&(d+="userIds\x3d"+encodeURIComponent(l)+"\x26")}d.lastIndexOf("\x26")===d.length-1&&(d=d.substring(0,d.length-1));d&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/info",data:d,global:!1,type:"get",success:function(a){for(var d in a)a.hasOwnProperty(d)&&
(b.push([d,a[d]]),va[d]=a[d],e.fetchContact(d).displayName=a[d]);B.updateMckContactNameArray(b)},error:function(){}})}};a.loadContacts=function(){var a=[];mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d0\x26pageSize\x3d30\x26orderBy\x3d1",type:"get",global:!1,success:function(c){d.hasClass("vis")&&("object"===typeof c&&0<c.users.length&&(b.each(c.users,function(b,c){if("undefined"!==typeof c.userId){var d=e.getContact(""+c.userId),d="undefined"===typeof d?e.createContactWithDetail(c):
e.updateContactDetail(d,c);La.push(d);a.push([c.userId,d.displayName]);c.connected?g.MCK_OL_MAP[c.userId]=!0:(g.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(S[c.userId]=c.lastSeenAtTime))}}),0<a.length&&B.updateMckContactNameArray(a)),e.addContactsToSearchList())},error:function(){l.removeClass("vis").addClass("n-vis");g.console.log("Unable to load contacts. Please reload page.")}})};a.loadUserProfile=function(b){if("undefined"!==typeof b){var c=[];b=""+b.split(",")[0];c.push(b);
a.loadUserProfiles(c)}};a.loadUserProfiles=function(d){var c=[];b.each(d,function(a,b){"undefined"===typeof e.getContact(b)&&c.push(b)});a.getUsersDetail(c,{async:!1})};a.getUsersDetail=function(a,c){if(!("undefined"===typeof a||1>a.length)){for(var d="undefined"!==typeof c.cached?c.cached:!0,h=[],l=a.filter(function(b,c){return a.indexOf(b)===c}),q=0;q<l.length;q++){var s=l[q];d&&"undefined"!==typeof da[s]||h.push(s)}if(0===h.length)c.setStatus?Q.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,
c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);else{var x={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/v2/detail",type:"post",async:"undefined"!==typeof c.async?c.async:!0,data:JSON.stringify({userIdList:h}),contentType:"application/json",success:function(a){"success"===a.status&&0<a.response.length&&b.each(a.response,function(a,b){da[b.userId]=b;g.MCK_OL_MAP[b.userId]=b.connected;var c=e.getContact(""+b.userId);"undefined"===typeof c?e.createContactWithDetail(b):
e.updateContactDetail(c,b)});c.setStatus?Q.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);x.status="success";x.data=a;c.callback&&c.callback(x)},error:function(){c.setStatus?Q.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);x.status="error";c.callback&&c.callback(x)}})}}};a.getUserStatus=function(a){var c=
{};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/chat/status",type:"get",success:function(d){0<d.users.length&&(Ma=[],b.each(d.users,function(a,b){var c=e.getContact(""+b.userId),c="undefined"===typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b);Ma.push(c.contactId)}));c.status="success";c.data=d;a.callback&&a.callback(c)},error:function(){c.status="error";a.callback&&a.callback(c)}})};a.blockUser=function(a,b){a&&"undefined"!==typeof b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",
type:"get",data:"userId\x3d"+a+"\x26block\x3d"+b,success:function(e){"object"===typeof e&&"success"===e.status&&(ha[a]=b,Q.toggleBlockUser(a,b))},error:function(){}})}},Za=new function(){var a=this,d,g,l,c,q,p,u,t;a.init=function(){b("#mck-sidebox");g=b("#mck-msg-preview");q=b("#mck-group-info-tab");b("#mck-sidebox-launcher");d=b("#mck-message-cell .mck-message-inner");l=b("#mck-msg-preview .mck-preview-icon");c=b("#mck-msg-preview .mck-preview-cont-name");u=b("#mck-msg-preview .mck-preview-msg-content");
t=b("#mck-msg-preview .mck-preview-file-content")};a.notifyUser=function(b){if(7!==b.type){var c=b.groupId?mckGroupUtils.getGroup(""+b.groupId):e.fetchContact(""+b.to.split(",")[0]),d=!1;b.groupId&&(d=!0);ba.loadUserProfile(b.to);d=e.getTabDisplayName(c.contactId,d);a.showNewMessageNotification(b,c,d);if(Pb&&!gb){var h=Yb;b=e.getTextForMessagePreview(b,c);"function"!==typeof Wa||c.isGroup||(c=Wa(c.contactId))&&"undefined"!==typeof c&&(h=c);mckNotificationUtils.sendDesktopNotification(d,h,b)}}};a.showNewMessageNotification=
function(a,b,p){if(Qb&&102!==a.contentType){var w=d.data("mck-id"),y=d.data("isgroup");if(w===b.contactId&&y===b.isGroup&&!q.hasClass("vis"))if(a.conversationId&&(qa||Ga)){if(w=d.data("mck-conversationid"),w="undefined"!==typeof w&&""!==w?w.toString():"",w===a.conversationId.toString())return}else return;g.data("isgroup",b.isGroup);g.data("mck-conversationid",a.conversationId?a.conversationId:"");w=e.getContactImageLink(b,p);a.message?(y=e.getMessageTextForContactPreview(a,b,50),u.html(""),"object"===
typeof y?u.append(y):u.html(y),u.removeClass("n-vis").addClass("vis")):u.html("");a.fileMetaKey?(t.html(e.getFileIcon(a)),t.removeClass("n-vis").addClass("vis"),""===u.html()&&u.removeClass("vis").addClass("n-vis")):(t.html(""),t.removeClass("vis").addClass("n-vis"));c.html(p);l.html(w);g.data("mck-id",b.contactId);g.show();setTimeout(function(){g.fadeOut(3E3)},1E4)}};a.unsubscribeToServiceWorker=function(){p&&navigator.serviceWorker.ready.then(function(a){p.unsubscribe().then(function(a){p=null;
console.log("Unsubscribed to notification successfully")})})};a.sendSubscriptionIdToServer=function(){if(p){var a=p.endpoint.split("/").slice(-1)[0];a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/plugin/update/sw/id",type:"post",data:"registrationId\x3d"+a,success:function(a){},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."))}})}};a.subscribeToServiceWorker=function(){Rb&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",
{scope:"./"}),navigator.serviceWorker.ready.then(function(b){b.pushManager.subscribe({userVisibleOnly:!0}).then(function(b){console.log("The reg ID is:: ",b.endpoint.split("/").slice(-1));p=b;a.sendSubscriptionIdToServer()})}))}},Ea=b(".chat-launcher-icon"),ea=new function(){var a=this;a.token=null;a.Identity=null;a.outgoingCallServices=null;a.incomingCallServices=null;var d=b(".mck-videocall-btn"),g=b(".applozic-vid-container"),l=b("#mck-sidebox"),c=b("#mck-video-call-indicator");a.hideVideoBox=
function(){g.addClass("n-vis").removeClass("vis");l.addClass("vis").removeClass("n-vis");c.addClass("n-vis").removeClass("vis")};a.init=function(){a.token=null!==B.getAppHeaders()?B.getAppHeaders().videoToken:void 0;a.ringToneForHost=Eb.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3");b("#mck-btn-video-call").on("click",function(c){if(a.token){c=y+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var d=w.sendVideoCallMessage(c,"CALL_DIALED",
102,!1),h=e.fetchContact(d.to),d=e.getTabDisplayName(h.contactId,!1),h=e.getContactImageLink(h,d),g=new Date;a.outgoingCallServices=new MckCallingService(y,ea.token,c,d,!0,g,w,h,!1,a.ringToneForHost);a.outgoingCallServices.startVideoCall();b("#mck-btn-video-call").data("isCallHost",!0);b("#mck-btn-video-call").data("callStartTime",g)}else alert("missing token... please refresh page..")});b("#mck-vid-receive-btn").on("click",function(a){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");
d.removeClass("vis").addClass("n-vis");a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");b("#mck-video-call-indicator").data("callReceived",!0);b("#mck-video-call-indicator").addClass("n-vis");ea.callReceived(a,c)});b("#mck-vid-reject-btn").on("click",function(a){console.log("call rejected");a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");ea.callRejected(a,c);b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};
a.InitilizeVideoClient=function(c,e){a.Identity=c;b.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:c,device:e},success:function(b){if(null!=b&&""!=b){a.token=b.token;var c=B.getAppHeaders();c.videoToken=b.token;B.setAppHeaders(c)}},error:function(a){console.log("error while getting token"+a)}})};a.callReceived=function(b,c){console.log("_this.callReceived");na&&na.stop();w.sendVideoCallMessage(b,"CALL_ANSWERED",102,c);a.incomingCallServices=
new MckCallingService(a.Identity,a.token,b,null,!1,null,w,null,c);a.incomingCallServices.startVideoCall()};a.callRejected=function(a,b){na&&na.stop();w.sendVideoCallMessage(a,"CALL_REJECTED",102,b)}},Eb,na=null;g.MCK_OL_MAP=[];l.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},
onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};var U=new function(a){var d=this,l=a.events,q=null,c=null,t="",p=null,D=[],I,s,x="",L=b("#mck-sidebox"),H=b("#mck-tab-title"),J=b(".mck-typing-box"),N=b("#mck-tab-status");b("#mck-offline-message-box");var M=b("#mck-typing-label"),F=b("#mck-message-cell .mck-message-inner");
d.init=function(){if("undefined"!==typeof Fa){var a=mckUtils.startsWith(Fa,"https")?"15675":"15674";"function"===typeof g.SockJS&&(x||(x=new SockJS(Fa+":"+a+"/stomp")),c=g.Stomp.over(x),c.heartbeat.outgoing=0,c.heartbeat.incoming=0,c.onclose=function(){d.disconnect()},c.connect("guest","guest",d.onConnect,d.onError,"/"),g.addEventListener("beforeunload",function(a){d.disconnect()}))}};d.checkConnected=function(a){c.connected?(I&&clearInterval(I),s&&clearInterval(s),I=setInterval(function(){d.connectToSocket(a)},
6E5),s=setInterval(function(){d.sendStatus(1)},12E5)):d.connectToSocket(a)};d.connectToSocket=function(a){if(!c.connected){if(a&&"block"===L.css("display"))if(a=F.data("mck-id")){var b=F.data("isgroup"),g=F.data("mck-conversationid"),l=F.data("mck-topicid");B.clearMckMessageArray();e.loadTab({tabId:a,isGroup:b,conversationId:g,topicId:l})}else B.clearMckMessageArray(),e.loadTab({tabId:"",isGroup:!1});d.init()}};d.stopConnectedCheck=function(){I&&clearInterval(I);s&&clearInterval(s);s=I="";d.disconnect()};
d.disconnect=function(){c&&c.connected&&(d.sendStatus(0),c.disconnect())};d.unsubscibeToTypingChannel=function(){c&&c.connected&&p&&(1===ga&&d.sendTypingStatus(0,t),p.unsubscribe());p=null};d.unsubscibeToNotification=function(){c&&c.connected&&q&&q.unsubscribe();q=null};d.subscibeToTypingChannel=function(a,b){var e=b?a:y;c&&c.connected?p=c.subscribe("/topic/typing-"+W+"-"+e,d.onTypingStatus):d.reconnect()};d.subscribeToOpenGroup=function(a){if(c&&c.connected){var b=c.subscribe("/topic/group-"+W+"-"+
a.contactId,d.onOpenGroupMessage);D.push(b.id);ib[a.contactId]=b.id}else d.reconnect()};d.sendTypingStatus=function(a,b){if(c&&c.connected){1===a&&1===ga&&c.send("/topic/typing-"+W+"-"+t,{"content-type":"text/plain"},W+","+y+","+a);if(b){if(b===t&&a===ga&&1===a)return;t=b;c.send("/topic/typing-"+W+"-"+b,{"content-type":"text/plain"},W+","+y+","+a);setTimeout(function(){ga=0},6E4)}else 0===a&&c.send("/topic/typing-"+W+"-"+t,{"content-type":"text/plain"},W+","+y+","+a);ga=a}};d.onTypingStatus=function(a){if(null!=
p&&p.id===a.headers.subscription){var b=a.body,c=b.split(",")[1],b=Number(b.split(",")[2]);a=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,a.headers.destination.length);var d=F.data("mck-id"),h=F.data("isgroup"),g=mckGroupUtils.getGroup(d);if(!ha[c]&&!Aa[c])if(1===b){if(!(y===c&&h||d!==c&&d!==a)){if(h=F.data("isgroup")){if(c!==y){if(u.authenticateGroupUser(g)||6===g.type&&!X.disableChatForNonGroupMember)H.addClass("mck-tab-title-w-typing"),N.removeClass("vis").addClass("n-vis"),
c=e.getTabDisplayName(c,!1),c=c.split(" ")[0],M.html(c+" "+MCK_LABELS["is.typing"]);7===g.type&&(H.addClass("mck-tab-title-w-typing"),M.html(MCK_LABELS["is.typing"]),N.html(""))}}else H.addClass("mck-tab-title-w-typing"),N.removeClass("vis").addClass("n-vis"),M.html(MCK_LABELS.typing);J.removeClass("n-vis").addClass("vis");setTimeout(function(){H.removeClass("mck-tab-title-w-typing");J.removeClass("vis").addClass("n-vis");H.hasClass("undefined"===typeof g||7!=g.type)&&N.removeClass("n-vis").addClass("vis");
M.html(MCK_LABELS.typing)},6E4)}}else H.removeClass("mck-tab-title-w-typing"),J.removeClass("vis").addClass("n-vis"),!H.hasClass("mck-tab-title-w-status")||"undefined"!==typeof g&&7==g.type||N.removeClass("n-vis").addClass("vis"),M.html(MCK_LABELS.typing)}};d.reconnect=function(){d.unsubscibeToTypingChannel();d.unsubscibeToNotification();d.disconnect();d.init()};d.onError=function(a){g.console.log("Error in channel notification. "+a);l.onConnectFailed()};d.sendStatus=function(a){c&&c.connected&&c.send("/topic/status-v2",
{"content-type":"text/plain"},ta+","+T+","+a)};d.onConnect=function(){c.connected?(q&&d.unsubscibeToNotification(),q=c.subscribe("/topic/"+ta,d.onMessage),d.sendStatus(1),d.checkConnected(!0)):setTimeout(function(){q=c.subscribe("/topic/"+ta,d.onMessage);d.sendStatus(1);d.checkConnected(!0)},5E3);l.onConnect()};d.onOpenGroupMessage=function(a){if(-1!==D.indexOf(a.headers.subscription)){var c=b.parseJSON(a.body),d=c.type;a=c.message;if("APPLOZIC_03"===d)B.updateLatestMessage(a),0!==a.type&&4!==a.type&&
(b("."+a.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(a.key)),l.onMessageSentUpdate({messageKey:a.key});else if("APPLOZIC_01"===d||"APPLOZIC_02"===d||"MESSAGE_RECEIVED"===d){B.updateLatestMessage(a);var h=a.groupId?mckGroupUtils.getGroup(a.groupId):e.getContact(a.to);b("#mck-sidebox-content");F.data("mck-id");if("APPLOZIC_01"===d||"MESSAGE_RECEIVED"===d){var g=e.getMessageFeed(a);l.onMessageReceived({message:g})}else"APPLOZIC_02"===d&&(g=e.getMessageFeed(a),
l.onMessageSent({message:g}));a.conversationId&&(g=O[a.conversationId],!qa&&!Ga||"object"===typeof g&&"object"===typeof K[g.topicId]||w.getTopicId({conversationId:a.conversationId,messageType:d,message:a,notifyUser:c.notifyUser,async:!1,populate:!1}));"undefined"===typeof h?(c={message:a,messageType:d,notifyUser:c.notifyUser},a.groupId?u.getGroupFeedFromMessage(c):(d=[],d.push(a.to),ba.getUsersDetail(d,c))):e.populateMessage(d,a,c.notifyUser)}}};d.onMessage=function(a){if(null!=q&&q.id===a.headers.subscription){a=
b.parseJSON(a.body);var c=a.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),e.addTooltip(a.message.split(",")[0]),l.onMessageDelivered({messageKey:a.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),
e.addTooltip(a.message.split(",")[0]),l.onMessageRead({messageKey:a.message.split(",")[0]});else if("APPLOZIC_05"===c){var d=a.message.split(",")[0],h=a.message.split(",")[1],p="1"===a.message.split(",")[2]?!0:!1;e.removedDeletedMessage(d,h,p);a={messageKey:a.message.split(",")[0]};p?a.groupId=h:a.userKey=h;console.log(a);l.onMessageDeleted(a)}else if("APPLOZIC_27"===c)d=a.message.split(",")[0],a=a.message.split(",")[1],"undefined"!==typeof d&&(e.removeConversationThread(d,!1),e.updateUnreadCount("user_"+
d,0,!0),h={userId:d},a&&(h.topicId=a),l.onConversationDeleted(h));else if("APPLOZIC_11"===c){d=a.message;p=e.fetchContact(d);h=F.data("mck-id");if(!ha[d]&&!Aa[d]){if(h!==p.contactId||F.data("isgroup")){var s=mckContactUtils.formatContactId(d);b("#li-user-"+s+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else b("#mck-tab-status").html(MCK_LABELS.online),Xa&&e.hideOfflineMessage();b(".mck-user-ol-status."+s).removeClass("n-vis").addClass("vis");b(".mck-user-ol-status."+s).next().html("("+
MCK_LABELS.online+")");g.MCK_OL_MAP[d]=!0;Q.updateUserStatus({userId:a.message,status:1})}l.onUserConnect({userId:a.message})}else if("APPLOZIC_12"===c)d=a.message.split(",")[0],a=a.message.split(",")[1],p=e.fetchContact(d),g.MCK_OL_MAP[d]=!1,a&&(S[d]=a),ha[d]||Aa[d]||(h=F.data("mck-id"),h!==p.contactId||F.data("isgroup")||(b("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(a)),Xa&&Sa.manageOfflineMessageTime(h)),b(".mck-user-ol-status."+p.htmlId).removeClass("vis").addClass("n-vis"),b(".mck-user-ol-status."+
p.htmlId).next().html("(Offline)"),b("#li-user-"+s+" .mck-ol-status").removeClass("vis").addClass("n-vis"),Q.updateUserStatus({userId:d,status:0,lastSeenAtTime:a})),l.onUserDisconnect({userId:d,lastSeenAtTime:a});else if("APPLOZIC_29"===c){d=a.message.split(",")[0];a=a.message.split(",")[1];p=e.fetchContact(d);e.updateUnreadCount("user_"+p.contactId,0,!0);h=F.data("mck-id");if("undefined"===typeof h||""===h)b("#li-user-"+p.htmlId+" .mck-unread-count-text").html(e.getUnreadCount("user_"+p.contactId)),
b("#li-user-"+p.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");h={userId:d};a&&(h.topicId=a);l.onConversationReadFromOtherSource(h)}else if("APPLOZIC_28"===c)d=a.message.split(",")[0],a=a.message.split(",")[1],h=F.data("mck-id"),h===d&&(b(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),b(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),p=e.getContact(d),
"undefined"===typeof p&&(h=[],h.push(d),ba.getUsersDetail(h,{}))),h={userId:d},a&&(h.topicId=a),l.onConversationRead(h);else if("APPLOZIC_16"===c)c=a.message.split(":")[0],d=a.message.split(":")[1],p=e.fetchContact(d),h=F.data("mck-id"),h===p.contactId?c===Ub[0]?(ha[p.contactId]=!0,Q.toggleBlockUser(h,!0)):(Aa[p.contactId]=!0,H.removeClass("mck-tab-title-w-status"),N.removeClass("vis").addClass("n-vis"),J.removeClass("vis").addClass("n-vis")):b("#li-user-"+p.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),
l.onUserBlocked({status:c,userId:d});else if("APPLOZIC_17"===c){c=a.message.split(":")[0];d=a.message.split(":")[1];p=e.fetchContact(d);h=F.data("mck-id");if(h===p.contactId)if(c===Ub[2])ha[p.contactId]=!1,Q.toggleBlockUser(h,!1);else{if(g.MCK_OL_MAP[h]||S[h])Aa[p.contactId]=!1,ha[h]||(g.MCK_OL_MAP[h]?N.html(MCK_LABELS.online):S[h]&&N.html(mckDateUtils.getLastSeenAtStatus(S[h])),H.addClass("mck-tab-title-w-status"),N.removeClass("n-vis").addClass("vis"))}else g.MCK_OL_MAP[h]&&b("#li-user-"+p.htmlId+
" .mck-ol-status").removeClass("n-vis").addClass("vis");l.onUserUnblocked({status:c,userId:d})}else if("APPLOZIC_18"===c)Ua=!1,l.onUserActivated();else if("APPLOZIC_19"===c)Ua=!0,l.onUserDeactivated();else if(d=a.message,"APPLOZIC_03"===c)B.updateLatestMessage(d),0!==d.type&&4!==d.type&&(b("."+d.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(d.key)),l.onMessageSentUpdate({messageKey:d.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===
c)B.updateLatestMessage(d),p=d.groupId?mckGroupUtils.getGroup(d.groupId):e.getContact(d.to),b("#mck-sidebox-content"),h=F.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===c?(h=e.getMessageFeed(d),l.onMessageReceived({message:h})):"APPLOZIC_02"===c&&(h=e.getMessageFeed(d),l.onMessageSent({message:h})),d.conversationId&&(h=O[d.conversationId],!qa&&!Ga||"object"===typeof h&&"object"===typeof K[h.topicId]||w.getTopicId({conversationId:d.conversationId,messageType:c,message:d,notifyUser:a.notifyUser,
async:!1,populate:!1})),"undefined"===typeof p?(a={message:d,messageType:c,notifyUser:a.notifyUser},d.groupId?u.getGroupFeedFromMessage(a):(h=[],h.push(d.to),ba.getUsersDetail(h,a))):(102==d.contentType&&Ja&&(a.notifyUser=!1,4==d.type&&"CALL_DIALED"==d.metadata.MSG_TYPE?(p=e.fetchContact(d.to),h=e.getTabDisplayName(p.contactId,!1),p=e.getContactImageLink(p,h),b("#mck-video-call-indicator").data("call-id",d.metadata.CALL_ID),b("#mck-video-call-indicator").data("isAudioCall",d.metadata.CALL_AUDIO_ONLY),
b("#mck-video-call-indicator-txt").html(h+" calling..."),b("#mck-video-call-icon").html(p),b("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),na.play(),setTimeout(function(){b("#mck-video-call-indicator").data("callReceived")||(console.log("call is not answered"),na.stop(),b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==d.type&&"CALL_REJECTED"==d.metadata.MSG_TYPE&&b("#mck-btn-video-call").data("isCallHost")&&(w.sendVideoCallMessage(d.metadata.CALL_ID,
"CALL_REJECTED",103,!1),ea.ringToneForHost.stop(),ea.outgoingCallServices.twilioService.leaveRoomIfJoined(),ea.hideVideoBox(),ea.outgoingCallServices&&(ea.outgoingCallServices.rejectedByReceiver=!0))),103==d.contentType?4==d.type&&"CALL_MISSED"==d.metadata.MSG_TYPE&&(b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),na&&na.stop()):e.populateMessage(c,d,a.notifyUser))}}}(l);l.getOptions=function(){return d};l.init=function(){new Audio(Zb);w.init();ca.init();Sa.initializeApp(d,!1);
Za.init();yb.init();e.initEmojis();Ja&&(Eb=new RingToneService,na=Eb.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3"),ea.init())};l.reInit=function(a){"object"===b.type(a)&&(a=b.extend(!0,{},Fb,a),g.sessionStorage.clear(),q=ta="",J=[],MCK_GROUP_MAP=[],fb=!0,ya=[],T="",hb=a.mode,ha=[],Aa=[],za=!1,Ba=90,W=a.appId,S=[],O=[],K=[],MCK_CLIENT_GROUP_MAP=[],gb=!0,MCK_LABELS=a.labels,H=0,MCK_BASE_URL=a.baseUrl,ua={},Ya=[],Ra=a.launcher,ib=[],Gb=a.userName,pa=a.visitor,
oa=[],La=[],Ha={},I=a.fileBaseUrl,lb=a.locShare,Ja=d.video,L=a.onInit,mb=a.onTopicDetails,va=[],wa=[],nb=a.onClose,ia=a.accessToken,ob=a.displayText,Oa=a.readConversation,ja=a.maxGroupSize,Z=[],pb=a.onTabClicked,Hb=a.contactNumber,rb=a.appModuleName,Ca=a.getTopicDetail,qb=a.maxAttachmentSize,sb=a.validateMessage,Va=a.contactDisplayName,Ma=[],Da=a.finalPriceResponse,Wa=a.contactDisplayImage,tb=a.priceWidget,X=d.openGroupSettings,Y=a.offlineMessageDetail,ub=a.getConversationDetail,Ka=a.authenticationTypeId,
y=pa?"guest":b.trim(a.userId),ab="boolean"===typeof a.olStatus?a.olStatus:!1,Ga="boolean"===typeof a.topicBox?a.topicBox:!1,Xa="boolean"===typeof a.showOfflineMessage?a.showOfflineMessage:!1,qa="boolean"===typeof a.topicHeader?a.topicHeader:!1,Qb="boolean"===typeof a.notification?a.notification:!0,Rb="boolean"===typeof a.swNotification?a.swNotification:!1,Ob=a.supportId?'data-mck-id\x3d"'+a.supportId+'"':"",Kb="boolean"===typeof a.hideGroupSubtitle?a.hideGroupSubtitle:!1,Lb="undefined"===typeof a.defaultMessageMetaData?
{}:a.defaultMessageMetaData,vb="boolean"===typeof a.groupUserCount?a.groupUserCount:!1,Pb="boolean"===typeof a.desktopNotification?a.desktopNotification:!1,wb="boolean"===typeof a.loadOwnContacts?a.loadOwnContacts:!1,Jb="boolean"===typeof a.messageBubbleAvator?a.messageBubbleAvator:!1,Nb="boolean"===typeof d.resetUserStatus?d.resetUserStatus:!1,bb="boolean"===typeof a.launchOnNewMessage?a.launchOnNewMessage:!1,Sb="boolean"===typeof a.autoTypeSearchEnabled?a.autoTypeSearchEnabled:!0,Mb="boolean"===
typeof a.checkUserBusyWithStatus?a.checkUserBusyWithStatus:!1,xb="boolean"===typeof a.launchOnUnreadMessage?a.launchOnUnreadMessage:!1,a.userId&&a.appId&&""!==b.trim(a.userId)&&""!==b.trim(a.appId)?(Sa.initializeApp(a,!0),d=a):g.console("Oops! looks like incorrect application id or user Id."))};l.loadTabView=function(a){"undefined"===typeof a.isGroup&&(a.isGroup=!1);e.loadTab(a);b("#mck-search").val("")};l.loadTab=function(a){e.loadTab({tabId:a,isGroup:!1});b("#mck-search").val("")};l.loadChat=function(a){if(!("undefined"!==
typeof a.userId&&""!==a.userId||"undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId))return"UserId or groupId or clientGroupId required";var d={tabId:a.userId,isGroup:!1},d={};a.userId&&(d.tabId=userId,d.isGroup=!1);a.displayName&&(d.userName=a.displayName);a.convId&&(d.conversationId=a.convId);if(a.groupId||a.clientGroupId)if(d.isGroup=!0,a.clientGroupId){d.clientGroupId=a.clientGroupId;var g=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);
if("object"===typeof g)d.tabId=g.contactId;else{mckGroupService.getGroupFeed({clientGroupId:d.clientGroupId,apzCallback:u.onGroupFeed,callback:u.loadGroupTab});b("#mck-search").val("");return}}else if(g=mckGroupUtils.getGroup(a.groupId),"object"===typeof g)d.tabId=a.groupId;else{mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:u.onGroupFeed,callback:u.loadGroupTab});b("#mck-search").val("");return}e.loadTab(d);b("#mck-search").val("")};l.uploadFile=function(a){ca.uploadFile(a)};l.audioAttach=
function(a){ca.audioRecoder(a)};l.loadGroupTab=function(a){if("undefined"===typeof a||""===a)return"GroupId required";"object"===typeof mckGroupUtils.getGroup(a)?(e.loadTab({tabId:a,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:a,apzCallback:u.onGroupFeed,callback:u.loadGroupTab})};l.loadGroupTabByClientGroupId=function(a){if("undefined"===typeof a.clientGroupId||""===a.clientGroupId)return"Client Group Id Required";var d=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);
"object"===typeof d?(e.loadTab({tabId:d.contactId,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:a.clientGroupId,apzCallback:u.onGroupFeed,callback:u.loadGroupTab})};l.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&e.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};l.loadTabWithTopic=function(a){if("object"===typeof a&&a.userId&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?
-1===M.indexOf(a.topicStatus)?M[0]:a.topicStatus.toString():M[0];if("function"===typeof Ca){var d=Ca(a.topicId);"object"===typeof d&&"undefined"!==d.title&&(K[a.topicId]=d)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.supportId?(b.isGroup=!0,b.supportId=supportId):b.isGroup=!1;w.getConversationId(b)}else{if(!a.userId)return"UserId required";if(!a.topicId)return"TopicId required"}};l.loadContacts=function(a){e.loadContacts(a)};l.setOffline=function(){"undefined"!==
typeof U&&U.sendStatus(0)};l.logout=function(){"undefined"!==typeof U&&U.disconnect();fb=!1};l.setOnline=function(){"undefined"!==typeof U&&U.sendStatus(1)};l.getUserStatus=function(a){"function"===typeof a.callback&&("undefined"!==typeof a.userIds?ba.getUsersDetail(a.userIds,a):ba.getUserStatus(a))};l.getGroupList=function(a){return"function"===typeof a.callback?(a.apzCallback=u.loadGroups,mckGroupService.loadGroups(a),"success"):"Callback Function Required"};l.leaveGroup=function(a){if("object"!==
typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=u.onGroupLeft,mckGroupService.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};l.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===
typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===jb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return ba.loadUserProfile(a.userId),a.apzCallback=u.onAddedGroupMember,mckGroupService.addGroupMember(a),"success";else a.callback({status:"error",
errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else return a.apzCallback=u.onRemovedGroupMember,mckGroupService.removeGroupMember(a),
"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.updateGroupInfo=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){if("undefined"!==typeof a.name&&""!==a.name||"undefined"!==typeof a.imageUrl&&""!==a.imageUrl||a.users&&0!==a.users.length){if(a.users&&
0<a.users.length){var d=[];b.each(a.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==jb.indexOf(b.role)&&d.push(b)});if(0===d.length){a.callback({status:"error",errorMessage:"Incorrect users detail"});return}}d=[];b(".mck-group-change-role-box.vis").each(function(a,e){var c=b(this),g=parseInt(c.find("select").val()),l=c.parents(".mck-li-group-member").data("role");g!==l&&(c={userId:c.parents(".mck-li-group-member").data("mck-id"),role:g},d.push(c))});a.apzCallback=u.onUpdateGroupInfo;
mckGroupService.updateGroupInfo(a);return"success"}a.callback({status:"error",errorMessage:"Group properties required"})}else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.getMessages=function(a){"function"===typeof a.callback&&w.getMessages(a)};l.getMessageList=function(a){return"undefined"!==typeof a&&"function"===typeof a.callback?(w.getMessageList(a),"success"):"Callback function required"};l.getMessageListByTopicId=function(a){if("object"!==
typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=M[0];var b=oa[a.topicId];b&&"object"===typeof O[b]?(a.conversationId=b,w.getMessageList(a)):(a.isExtMessageList=!0,a.pageSize=1,w.fetchConversationByTopicId(a));
return"success"}a.callback("TopicId required")}else a.callback({status:"error",errorMessage:"Id or clientGroupId required"});else return"Callback function required."};l.sendMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},Xb,a);var d=a.message;if(!a.to)return"To field required";if("undefined"===typeof d||""===d)return"Message field required";if(12<a.type)return"Invalid message type";d=b.trim(d);a={to:b.trim(a.to),type:a.messageType,contentType:a.type,message:d};w.sendMessage(a);return"success"}return"Unsupported format. Please check format"};
l.sendGroupMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},Xb,a);var d=a.message;if(!a.groupId&&!a.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof d||""===d)return"message field required";if(12<a.type)return"invalid message type";d=b.trim(d);d={type:a.messageType,contentType:a.type,message:d};if(a.groupId)d.groupId=b.trim(a.groupId);else if(a.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(a.clientGroupId))return"group not found";
d.clientGroupId=b.trim(a.clientGroupId)}w.sendMessage(d);return"success"}return"Unsupported format. Please check format"};l.addWelcomeMessage=function(a){if("object"===typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";w.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};l.createGroup=function(a){if("object"===typeof a)if("function"===typeof a.callback){var b=
a.users;if("undefined"===typeof b||1>b.length)a.callback({status:"error",errorMessage:"Users list required"});else if(b.length>ja)a.callback({status:"error",errorMessage:"Users limit exceeds "+ja+". Max number of users allowed is "+ja+"."});else if(a.groupName)if("undefined"===typeof a.type||""===a.type)a.callback({status:"error",errorMessage:"Group type required"});else if(-1===kb.indexOf(a.type))a.callback({status:"error",errorMessage:"Invalid group type"});else return w.getGroup(a),"success";else a.callback({status:"error",
errorMessage:"Group name required"})}else return"Callback function required";else return"Unsupported Format. Please check format"};l.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>ja)return"Users limit exceeds "+ja+". Max number of users allowed is "+ja+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===kb.indexOf(a.type))return"Invalid group type";
w.getGroup(a);return"success"}return"Unsupported format. Please check format"};l.getTotalUnreadCount=function(){return H};l.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(l.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(l.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(l.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(l.events.onMessageRead=a.onMessageRead),"function"===
typeof a.onMessageDeleted&&(l.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(l.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(l.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(l.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(l.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&
(l.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(l.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(l.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(l.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(l.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(l.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&
(l.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(l.events.onUserDeactivated=a.onUserDeactivated))};l.getConversation=function(a){w.getTopicId({conversationId:a.conversationId})}}var Fb={baseUrl:"https://apps.applozic.com",fileBaseUrl:"https://applozic.appspot.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,
supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!1,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,labels:{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!",
"no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type",
"group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...",
"is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen",
"last.seen.on":"Last seen on",ago:"ago","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",
GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},Xb={messageType:5,type:0};b.fn.applozic=function(d,g){var t=b("#mck-sidebox");"object"===b.type(d)&&(d=b.extend(!0,{},Fb,d));var q=void 0;if("undefined"!==typeof t.data("applozic_instance"))if(q=t.data("applozic_instance"),"string"===b.type(d))switch(d){case "reInitialize":return q.reInit(g);case "loadConvTab":q.loadConvTab(g);
break;case "loadTab":q.loadTab(g);break;case "uploadFile":q.uploadFile(g);break;case "loadTabView":q.loadTabView(g);break;case "loadChat":q.loadChat(g);break;case "loadContextualTab":return q.loadTabWithTopic(g);case "audioAttach":q.audioAttach(g);break;case "addWelcomeMessage":q.addWelcomeMessage(g);break;case "loadContacts":q.loadContacts(g);break;case "sendMessage":return q.sendMessage(g);case "sendGroupMessage":return q.sendGroupMessage(g);case "createGroup":return q.createGroup(g);case "loadBroadcastTab":return g.groupName=
g.groupName?g.groupName:"Broadcast",g.type=5,q.initGroupTab(g);case "initBroadcastTab":return g.groupName=g.groupName?g.groupName:"Broadcast",g.type=5,q.initGroupTab(g);case "initGroupTab":return q.initGroupTab(g);case "loadGroupTab":return q.loadGroupTab(g);case "loadGroupTabByClientGroupId":return q.loadGroupTabByClientGroupId(g);case "setOffline":return q.setOffline(),"success";case "setOnline":return q.setOffline(),"success";case "logout":return q.logout(),"success";case "getUserDetail":return q.getUserStatus(g),
"success";case "getGroupList":return q.getGroupList(g),"success";case "leaveGroup":return q.leaveGroup(g);case "addGroupMember":return q.addGroupMember(g);case "removeGroupMember":return q.removeGroupMember(g);case "updateGroupInfo":return q.updateGroupInfo(g);case "getMessages":q.getMessages(g);break;case "messageList":return q.getMessageList(g);case "getMessageListByTopicId":return q.getMessageListByTopicId(g);case "getTotalUnreadCount":return q.getTotalUnreadCount();case "subscribeToEvents":return q.subscribeToEvents(g);
case "getConversation":return q.getConversation(g)}else"object"===b.type(d)&&q.reInit(d);else"object"===b.type(d)&&(d.userId&&d.appId&&""!==b.trim(d.userId)&&""!==b.trim(d.appId)?"undefined"!==typeof t.data("applozic_instance")?(q=t.data("applozic_instance"),q.reInit(d)):(jQuery="undefined"!==typeof d.ojq?$=d.ojq:$=b,"function"===typeof d.obsm?($.fn.modal=d.obsm,jQuery.fn.modal=d.obsm):"function"===typeof b.fn.modal?(q=b.fn.modal.noConflict(),$.fn.modal=q,jQuery.fn.modal=q):"function"===typeof $.fn.modal&&
(q=$.fn.modal.noConflict(),$.fn.modal=q,jQuery.fn.modal=q),"function"===typeof d.omckm?b.fn.mckModal=d.omckm:"function"===typeof b.fn.mckModal?b.fn.mckModal=b.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(b.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(b.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof b.fn.linkify&&($.fn.linkify=b.fn.linkify,jQuery.fn.linkify=b.fn.linkify),"function"===typeof $.fn.emojiarea?b.fn.emojiarea=$.fn.emojiarea:
"function"===typeof b.fn.emojiarea&&($.fn.emojiarea=b.fn.emojiarea,jQuery.fn.emojiarea=b.fn.emojiarea),"function"===typeof $.fn.locationpicker?b.fn.locationpicker=$.fn.locationpicker:"function"===typeof b.fn.locationpicker&&($.fn.locationpicker=b.fn.locationpicker,jQuery.fn.locationpicker=b.fn.locationpicker),q=new eb(d),t.data("applozic_instance",q),q.init()):alert("Oops! looks like incorrect application id or user Id."))};b.fn.applozic.defaults=Fb})($applozic,window,document);
